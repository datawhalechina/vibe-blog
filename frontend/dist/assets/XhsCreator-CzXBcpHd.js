import{h as w,l as z,d as O,c as b,a as t,t as P,g as M,o as S,_ as U,m as A,F as L,r as G,n as J,p as H,u as q,q as F,e as K,b as _,w as Q,s as y,x as W,i as Y,y as Z,j as ee,k as te,z as se}from"./index-CX2luUoy.js";function oe(){const s=w(!1),i=w(null),e=w(""),l=w(null);let a=null,f=null;const p=async(n,o)=>{if(s.value)return{success:!1,error:"æ­£åœ¨ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™"};e.value="",s.value=!0,f=Date.now();try{const d=await(await fetch("/api/xhs/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:n.topic,count:n.count,style:n.style,generate_video:n.generate_video})})).json();if(!d.success)throw new Error(d.error||"ä»»åŠ¡åˆ›å»ºå¤±è´¥");return i.value=d.task_id,g(d.task_id,o),{success:!0,task_id:d.task_id}}catch(c){return e.value="âŒ "+c.message,s.value=!1,{success:!1,error:c.message}}},g=(n,o)=>{a&&a.close(),a=new EventSource(`/api/xhs/stream/${n}`),a.addEventListener("progress",c=>{var m;const d=JSON.parse(c.data);(m=o.onProgress)==null||m.call(o,d)}),a.addEventListener("search",c=>{var m;const d=JSON.parse(c.data);(m=o.onSearch)==null||m.call(o,d)}),a.addEventListener("outline",c=>{var m;const d=JSON.parse(c.data);(m=o.onOutline)==null||m.call(o,d)}),a.addEventListener("content",c=>{var m;const d=JSON.parse(c.data);(m=o.onContent)==null||m.call(o,d),l.value={...l.value,titles:d.titles,copywriting:d.copywriting,tags:d.tags}}),a.addEventListener("storyboard",c=>{var m;const d=JSON.parse(c.data);(m=o.onStoryboard)==null||m.call(o,d)}),a.addEventListener("image_progress",c=>{var m;const d=JSON.parse(c.data);(m=o.onImageProgress)==null||m.call(o,d)}),a.addEventListener("image",c=>{var m;const d=JSON.parse(c.data);(m=o.onImage)==null||m.call(o,d)}),a.addEventListener("video",c=>{var m;const d=JSON.parse(c.data);(m=o.onVideo)==null||m.call(o,d),l.value&&(l.value.video_url=d.url)}),a.addEventListener("complete",c=>{var m;const d=JSON.parse(c.data);a==null||a.close(),a=null,s.value=!1,l.value={...l.value,...d,image_urls:d.image_urls},(m=o.onComplete)==null||m.call(o,d)}),a.addEventListener("error",c=>{var d;if(c.data){const m=JSON.parse(c.data);a==null||a.close(),a=null,s.value=!1,e.value="âŒ "+m.message,(d=o.onError)==null||d.call(o,m.message)}}),a.addEventListener("cancelled",()=>{var c;a==null||a.close(),a=null,s.value=!1,(c=o.onCancelled)==null||c.call(o)}),a.onerror=()=>{(a==null?void 0:a.readyState)===EventSource.CLOSED&&console.log("SSE è¿æ¥å·²å…³é—­")}},h=async()=>{if(!i.value)return!1;try{return await fetch(`/api/xhs/tasks/${i.value}/cancel`,{method:"POST"}),a==null||a.close(),a=null,s.value=!1,!0}catch(n){return console.error("å–æ¶ˆè¯·æ±‚å¤±è´¥:",n),!1}},$=()=>{a==null||a.close(),a=null,s.value=!1,i.value=null},v=()=>f?Math.ceil((Date.now()-f)/1e3):0;return{isLoading:s,currentTaskId:i,errorMsg:e,currentResult:l,generate:p,cancel:h,cleanup:$,getElapsedTime:v}}function ae(){const s=w(0),i=w("ğŸš€ å°çº¢ä¹¦å†…å®¹ç”Ÿæˆä¸­..."),e=w("å‡†å¤‡ä¸­..."),l=w("é¢„è®¡å‰©ä½™: --"),a=w(null),f=w(null),p=[{id:"search",icon:"ğŸ”",name:"æœç´¢"},{id:"outline",icon:"ğŸ“‹",name:"å¤§çº²"},{id:"content",icon:"ğŸ“",name:"æ–‡æ¡ˆ"},{id:"storyboard",icon:"ğŸ¨",name:"åˆ†é•œ"},{id:"images",icon:"ğŸ–¼ï¸",name:"å›¾ç‰‡"},{id:"video",icon:"ğŸ¬",name:"è§†é¢‘"}],g=z({}),h=z({});let $=null;const v=()=>{s.value=0,e.value="å‡†å¤‡ä¸­...",l.value="é¢„è®¡å‰©ä½™: --",i.value="ğŸš€ å°çº¢ä¹¦å†…å®¹ç”Ÿæˆä¸­...",f.value=null,$=Date.now(),p.forEach(C=>{g[C.id]="waiting",h[C.id]=""})},n=(C,I)=>{s.value=C,e.value=I,d(C)},o=(C,I)=>{const D=p.map(r=>r.id);let N=D.indexOf(C);const V=C==="complete";V&&(N=D.length),D.forEach((r,u)=>{u<N||V?g[r]="completed":u===N?(g[r]="active",r==="images"&&I&&(f.value=I)):g[r]="waiting"})},c=(C,I)=>{h[C]=I},d=C=>{if(!$||C<=0)return;const D=(Date.now()-$)/1e3/C*(100-C);D>60?l.value=`é¢„è®¡å‰©ä½™: ${Math.ceil(D/60)} åˆ†é’Ÿ`:l.value=`é¢„è®¡å‰©ä½™: ${Math.ceil(D)} ç§’`},m=()=>{s.value=100,i.value="ğŸ‰ ç”Ÿæˆå®Œæˆï¼",e.value="å…¨éƒ¨å®Œæˆ";const C=Math.ceil((Date.now()-($||Date.now()))/1e3);l.value=`æ€»è€—æ—¶: ${C} ç§’`,p.forEach(I=>g[I.id]="completed")},E=C=>{i.value="âŒ ç”Ÿæˆå¤±è´¥",e.value=C},x=()=>{i.value="âš ï¸ å·²å–æ¶ˆç”Ÿæˆ",e.value="ä»»åŠ¡å·²è¢«ç”¨æˆ·å–æ¶ˆ"},j=C=>{const I=g[C];return I==="completed"?"completed":I==="active"?"active":"waiting"},B=C=>{const I=g[C];return I==="completed"?"å·²å®Œæˆ":I==="active"?"è¿›è¡Œä¸­":"ç­‰å¾…ä¸­"};return{progressPercent:s,progressTitle:i,currentStageText:e,timeEstimate:l,hoveredStage:a,imageSubProgress:f,stages:p,stageStatuses:g,stageDetails:h,reset:v,updateProgress:n,updateStageIndicators:o,updateStageDetail:c,markComplete:m,markError:E,markCancelled:x,getStageClass:j,getStageStatus:B}}function ne(){const s=w([]),i=v=>{s.value=Array.from({length:v},(n,o)=>({loading:!0,url:"",prompt:"",statusText:`ç¬¬ ${o+1} é¡µ`,showTooltip:!1}))},e=(v,n)=>{s.value[v]&&(s.value[v].statusText=n)},l=(v,n)=>{s.value[v]&&(s.value[v].loading=!1,s.value[v].url=n)},a=(v,n)=>{s.value[v]&&(s.value[v].prompt=n)},f=v=>{v.forEach(n=>{s.value[n.index]&&(s.value[n.index].prompt=n.prompt||"")})},p=v=>{v.forEach((n,o)=>{var c;(c=s.value[o])!=null&&c.loading&&(s.value[o].loading=!1,s.value[o].url=n)})},g=async v=>{if(!v||v.length===0){alert("æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡");return}alert(`å¼€å§‹ä¸‹è½½ ${v.length} å¼ å›¾ç‰‡`);for(let n=0;n<v.length;n++)try{const c=await(await fetch(v[n])).blob(),d=URL.createObjectURL(c),m=document.createElement("a");m.href=d,m.download=`xhs_${n+1}.jpg`,document.body.appendChild(m),m.click(),document.body.removeChild(m),await new Promise(E=>setTimeout(E,200)),URL.revokeObjectURL(d),n<v.length-1&&await new Promise(E=>setTimeout(E,3e3))}catch(o){console.error(`ä¸‹è½½ç¬¬ ${n+1} å¼ å›¾ç‰‡å¤±è´¥:`,o),window.open(v[n],"_blank")}alert(`âœ“ æ‰€æœ‰ ${v.length} å¼ å›¾ç‰‡ä¸‹è½½å®Œæˆ`)},h=async v=>{var o;const n=(o=s.value[v])==null?void 0:o.prompt;if(!n)return!1;try{return await navigator.clipboard.writeText(n),alert("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿"),!0}catch(c){return console.error("å¤åˆ¶å¤±è´¥:",c),!1}},$=v=>{s.value=v.map((n,o)=>({loading:!1,url:n,prompt:"",statusText:`ç¬¬ ${o+1} é¡µ`,showTooltip:!1}))};return{imageSlots:s,initPlaceholders:i,updateImageStatus:e,setImageUrl:l,setImagePrompt:a,setImagePrompts:f,ensureAllImagesLoaded:p,downloadAll:g,copyPrompt:h,loadFromHistory:$}}function le(){const s=w("sora2"),i=w("ghibli_summer"),e=w("60"),l=w(!1),a=w(!1),f=w(0),p=w("å‡†å¤‡ä¸­..."),g=w(""),h=async(o,c)=>{if(!o||o.length===0)return{success:!1,error:"è¯·å…ˆç”Ÿæˆå°çº¢ä¹¦å›¾ç‰‡"};l.value=!0,a.value=!0,f.value=0,p.value="å‡†å¤‡ç”Ÿæˆè®²è§£è§†é¢‘...",g.value="";let d=0;const m=setInterval(()=>{d<90&&(d+=Math.random()*5,f.value=Math.min(d,90),d<20?p.value="åˆ›å»ºæ—¶é—´çº¿...":d<40?p.value="ç”ŸæˆåŠ¨ç”»æŒ‡ä»¤...":d<80?p.value=`ç”Ÿæˆè§†é¢‘ç‰‡æ®µ (${Math.floor(d/20)}/${o.length})...`:p.value="åˆæˆæœ€ç»ˆè§†é¢‘...")},2e3);try{const E=await fetch("/api/xhs/explanation-video",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({images:o,scripts:c,style:i.value,target_duration:parseInt(e.value),video_model:s.value})});clearInterval(m);const x=await E.json();if(x.success&&x.video_url)return g.value=x.video_url,f.value=100,p.value="âœ… è§†é¢‘ç”Ÿæˆå®Œæˆï¼",setTimeout(()=>{a.value=!1},2e3),{success:!0,video_url:x.video_url};throw new Error(x.error||"è§†é¢‘ç”Ÿæˆå¤±è´¥")}catch(E){return clearInterval(m),f.value=100,p.value="âŒ ç”Ÿæˆå¤±è´¥: "+E.message,setTimeout(()=>{a.value=!1},5e3),{success:!1,error:E.message}}finally{l.value=!1}},$=()=>{if(!g.value){alert("æ²¡æœ‰å¯ä¸‹è½½çš„è§†é¢‘");return}const o=document.createElement("a");o.href=g.value,o.download="explanation_video.mp4",o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o)},v=async()=>{if(!g.value)return alert("æ²¡æœ‰å¯å¤åˆ¶çš„é“¾æ¥"),!1;try{return await navigator.clipboard.writeText(g.value),alert("âœ… è§†é¢‘é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿"),!0}catch{return prompt("è¯·æ‰‹åŠ¨å¤åˆ¶è§†é¢‘é“¾æ¥:",g.value),!1}},n=()=>{l.value=!1,a.value=!1,f.value=0,p.value="å‡†å¤‡ä¸­...",g.value=""};return{videoModel:s,videoStyle:i,videoDuration:e,isGenerating:l,showProgress:a,progressPercent:f,progressText:p,videoUrl:g,generate:h,download:$,copyUrl:v,reset:n}}function re(s){try{const l=JSON.parse(s);if(Array.isArray(l))return l}catch{}const i=[],e=s.split(";");for(const l of e){const a=l.trim();if(!a)continue;const f=a.indexOf("=");f>0&&i.push({name:a.substring(0,f).trim(),value:a.substring(f+1).trim(),domain:".xiaohongshu.com",path:"/"})}return i}function ie(){const s=w(!1),i=w("");return{showModal:s,cookieInput:i,openModal:()=>{s.value=!0},closeModal:()=>{s.value=!1},publish:async p=>{var h,$;if(!i.value.trim())return{success:!1,error:"è¯·è¾“å…¥ Cookie"};const g=re(i.value);if(!g||g.length===0)return{success:!1,error:"Cookie è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ ¼å¼"};if(!((h=p==null?void 0:p.image_urls)!=null&&h.length))return{success:!1,error:"æ²¡æœ‰å¯å‘å¸ƒçš„å›¾ç‰‡"};try{const n=await(await fetch("/api/xhs/publish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cookies:g,title:(($=p.titles)==null?void 0:$[0])||p.topic||"",content:p.copywriting||"",tags:p.tags||[],images:p.image_urls||[]})})).json();return n.success?{success:!0,url:n.url}:{success:!1,error:n.message||n.error||"æœªçŸ¥é”™è¯¯"}}catch(v){return{success:!1,error:v.message}}},copyCopywriting:async p=>{var n;if(!p)return alert("è¯·å…ˆç”Ÿæˆå†…å®¹"),!1;const g=((n=p.titles)==null?void 0:n[0])||"",h=p.copywriting||"",$=(p.tags||[]).map(o=>"#"+o).join(" "),v=`${g}

${h}

${$}`;try{return await navigator.clipboard.writeText(v),alert("âœ… æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿"),!0}catch{return alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶"),!1}}}}const ue={class:"input-card"},de={class:"form-group"},ce=["value"],ve={class:"options-row"},pe={class:"option-group"},ge=["value"],me={class:"option-group"},fe=["value"],ye={class:"option-group"},he=["value"],we=["disabled"],$e={key:0,class:"error-msg show"},be=O({__name:"XhsInputCard",props:{topic:{},pageCount:{},visualStyle:{},generateVideo:{},isLoading:{type:Boolean},errorMsg:{}},emits:["update:topic","update:pageCount","update:visualStyle","update:generateVideo","generate"],setup(s){return(i,e)=>(S(),b("div",ue,[t("div",de,[e[5]||(e[5]=t("label",null,"ğŸ“Œ è¾“å…¥ä¸»é¢˜",-1)),t("textarea",{value:s.topic,onInput:e[0]||(e[0]=l=>i.$emit("update:topic",l.target.value)),class:"text-input",placeholder:"ä¾‹å¦‚ï¼šRAGæŠ€æœ¯å…¥é—¨ã€Redisç¼“å­˜åŸç†ã€Pythonè£…é¥°å™¨è¯¦è§£..."},null,40,ce)]),t("div",ve,[t("div",pe,[e[7]||(e[7]=t("label",null,"ğŸ“„ é¡µé¢æ•°é‡",-1)),t("select",{value:s.pageCount,onChange:e[1]||(e[1]=l=>i.$emit("update:pageCount",l.target.value))},[...e[6]||(e[6]=[t("option",{value:"3"},"3 é¡µ",-1),t("option",{value:"4"},"4 é¡µ",-1),t("option",{value:"5"},"5 é¡µ",-1),t("option",{value:"6"},"6 é¡µ",-1)])],40,ge)]),t("div",me,[e[9]||(e[9]=t("label",null,"ğŸ¨ è§†è§‰é£æ ¼",-1)),t("select",{value:s.visualStyle,onChange:e[2]||(e[2]=l=>i.$emit("update:visualStyle",l.target.value))},[...e[8]||(e[8]=[t("option",{value:"hand_drawn"},"æ¸©æš–æ‰‹ç»˜é£",-1),t("option",{value:"claymation"},"é»åœŸåŠ¨ç”»é£",-1),t("option",{value:"ghibli_summer"},"ğŸŒ» å®«å´éªçš„å¤å¤©ï¼ˆæ¼«ç”»åˆ†é•œï¼‰",-1)])],40,fe)]),t("div",ye,[e[11]||(e[11]=t("label",null,"ğŸ¬ åŠ¨ç”»å°é¢",-1)),t("select",{value:s.generateVideo,onChange:e[3]||(e[3]=l=>i.$emit("update:generateVideo",l.target.value))},[...e[10]||(e[10]=[t("option",{value:"false"},"ä»…é™æ€å›¾",-1),t("option",{value:"true"},"ç”ŸæˆåŠ¨ç”»",-1)])],40,he)])]),t("button",{class:"generate-btn",disabled:s.isLoading||!s.topic.trim(),onClick:e[4]||(e[4]=l=>i.$emit("generate"))}," âœ¨ å¼€å§‹ç”Ÿæˆ ",8,we),s.errorMsg?(S(),b("div",$e,P(s.errorMsg),1)):M("",!0)]))}}),Se=U(be,[["__scopeId","data-v-8de87d60"]]),Ce={key:0,class:"progress-container show"},ke={class:"progress-header"},Pe={class:"progress-title"},Te={class:"main-progress"},Ie={class:"progress-bar"},Me={class:"progress-percent"},Ee={class:"stage-indicators"},xe=["data-stage","onMouseenter"],De={class:"stage-icon"},_e={class:"stage-name"},Oe={class:"stage-status"},Ue={key:0,class:"stage-sub-progress"},Le={key:1,class:"stage-detail"},Ne={key:0,class:"stage-arrow"},Re={class:"progress-info"},Xe={class:"current-stage"},Ve={class:"time-estimate"},Ge=O({__name:"XhsProgressPanel",props:{show:{type:Boolean,default:!1},progressPercent:{default:0},progressTitle:{default:"ç”Ÿæˆä¸­..."},currentStageText:{default:"å‡†å¤‡ä¸­..."},timeEstimate:{default:"é¢„è®¡å‰©ä½™: --"},imageSubProgress:{},stages:{default:()=>[]},stageStatuses:{default:()=>({})},stageDetails:{default:()=>({})},getStageClass:{},getStageStatus:{}},emits:["cancel"],setup(s){const i=w(null);return(e,l)=>s.show?(S(),b("div",Ce,[t("div",ke,[t("span",Pe,P(s.progressTitle),1),t("button",{class:"cancel-btn",onClick:l[0]||(l[0]=a=>e.$emit("cancel"))},"å–æ¶ˆç”Ÿæˆ")]),t("div",Te,[t("div",Ie,[t("div",{class:"progress-fill",style:A({width:s.progressPercent+"%"})},[...l[2]||(l[2]=[t("div",{class:"progress-glow"},null,-1)])],4)]),t("span",Me,P(s.progressPercent)+"%",1)]),t("div",Ee,[(S(!0),b(L,null,G(s.stages,(a,f)=>(S(),b(L,{key:a.id},[t("div",{class:J(["stage-item",s.getStageClass(a.id)]),"data-stage":a.id,onMouseenter:p=>i.value=a.id,onMouseleave:l[1]||(l[1]=p=>i.value=null)},[t("div",De,P(a.icon),1),t("div",_e,P(a.name),1),t("div",Oe,P(s.getStageStatus(a.id)),1),a.id==="images"&&s.imageSubProgress?(S(),b("div",Ue," ("+P(s.imageSubProgress.current)+"/"+P(s.imageSubProgress.total)+") ",1)):M("",!0),i.value===a.id&&s.stageDetails[a.id]?(S(),b("div",Le,P(s.stageDetails[a.id]),1)):M("",!0)],42,xe),f<s.stages.length-1?(S(),b("div",Ne,"â†’")):M("",!0)],64))),128))]),t("div",Re,[t("span",Xe,P(s.currentStageText),1),t("span",Ve,P(s.timeEstimate),1)])])):M("",!0)}}),Je=U(Ge,[["__scopeId","data-v-b168af2e"]]),je={key:0,class:"images-section"},Be={class:"images-grid"},ze=["id","onMouseenter","onMouseleave"],Ae={key:0,class:"placeholder"},He=["src","alt"],qe={class:"caption"},Fe={key:0,class:"prompt-tooltip"},Ke={class:"tooltip-header"},Qe=["onClick"],We=O({__name:"XhsImageSlots",props:{show:{type:Boolean},imageSlots:{}},emits:["copy-prompt","update-tooltip"],setup(s,{emit:i}){const e=i,l=f=>{e("update-tooltip",f,!0)},a=f=>{e("update-tooltip",f,!1)};return(f,p)=>s.show?(S(),b("div",je,[p[1]||(p[1]=t("h3",{style:{"margin-bottom":"12px"}},"ğŸ“· ä¿¡æ¯å›¾é¢„è§ˆ",-1)),t("div",Be,[(S(!0),b(L,null,G(s.imageSlots,(g,h)=>(S(),b("div",{key:h,class:J(["image-card",{loading:g.loading}]),id:`image-slot-${h}`,onMouseenter:$=>l(h),onMouseleave:$=>a(h)},[g.loading?(S(),b("div",Ae,[p[0]||(p[0]=t("div",{class:"mini-spinner"},null,-1)),t("span",null,P(g.statusText||`ç¬¬ ${h+1} é¡µ`),1)])):(S(),b(L,{key:1},[t("img",{src:g.url,alt:`ç¬¬${h+1}å¼ `},null,8,He),t("div",qe,"ç¬¬ "+P(h+1)+" é¡µ"+P(h===0?" (å°é¢)":""),1),g.showTooltip&&g.prompt?(S(),b("div",Fe,[t("div",Ke,[t("span",null,"ğŸ¨ ç¬¬ "+P(h+1)+" é¡µè§†è§‰æŒ‡ä»¤",1),t("button",{onClick:H($=>f.$emit("copy-prompt",h),["stop"])},"å¤åˆ¶",8,Qe)]),t("pre",null,P(g.prompt),1)])):M("",!0)],64))],42,ze))),128))])])):M("",!0)}}),Ye=U(We,[["__scopeId","data-v-00873f0d"]]),Ze={key:0,class:"result-section show"},et={class:"copy-section"},tt={class:"titles-list"},st={class:"copy-content"},ot={class:"tags-list"},at={class:"publish-section"},nt={class:"publish-buttons"},lt=O({__name:"XhsResultDisplay",props:{show:{type:Boolean},result:{}},emits:["copy-copywriting","download-images","open-publish"],setup(s){return(i,e)=>{var l,a,f;return s.show?(S(),b("div",Ze,[e[8]||(e[8]=t("h2",{class:"result-title"},"ğŸ‰ ç”Ÿæˆå®Œæˆ",-1)),t("div",et,[e[3]||(e[3]=t("h3",null,"ğŸ“ æ¨èæ ‡é¢˜",-1)),t("div",tt,[(S(!0),b(L,null,G(((l=s.result)==null?void 0:l.titles)||[],(p,g)=>(S(),b("div",{key:g,class:J(["title-item",{primary:g===0}])},P(g===0?"â­ ":"")+P(p),3))),128))]),e[4]||(e[4]=t("h3",null,"ğŸ“„ æ–‡æ¡ˆå†…å®¹",-1)),t("div",st,P(((a=s.result)==null?void 0:a.copywriting)||""),1),e[5]||(e[5]=t("h3",{style:{"margin-top":"16px"}},"ğŸ·ï¸ æ¨èæ ‡ç­¾",-1)),t("div",ot,[(S(!0),b(L,null,G(((f=s.result)==null?void 0:f.tags)||[],p=>(S(),b("span",{key:p,class:"tag"},"#"+P(p),1))),128))])]),t("div",at,[e[6]||(e[6]=t("h3",null,"ğŸš€ å‘å¸ƒåˆ°å°çº¢ä¹¦",-1)),e[7]||(e[7]=t("p",{style:{color:"#666","font-size":"14px","margin-bottom":"16px"}}," è¯·å…ˆåœ¨æµè§ˆå™¨ç™»å½•å°çº¢ä¹¦åˆ›ä½œè€…ä¸­å¿ƒï¼Œç„¶åä½¿ç”¨æµè§ˆå™¨æ‰©å±•å¯¼å‡º Cookie ",-1)),t("div",nt,[t("button",{class:"publish-btn outline",onClick:e[0]||(e[0]=p=>i.$emit("copy-copywriting"))}," ğŸ“‹ å¤åˆ¶æ–‡æ¡ˆ "),t("button",{class:"publish-btn outline",onClick:e[1]||(e[1]=p=>i.$emit("download-images"))}," ğŸ“¥ ä¸‹è½½å›¾ç‰‡ "),t("button",{class:"publish-btn primary",onClick:e[2]||(e[2]=p=>i.$emit("open-publish"))}," ğŸš€ ä¸€é”®å‘å¸ƒ ")])])])):M("",!0)}}}),rt=U(lt,[["__scopeId","data-v-60c49c74"]]),it={key:0,class:"video-section"},ut={class:"video-options"},dt=["value"],ct=["value"],vt=["value"],pt=["disabled"],gt={key:0,class:"video-progress-container show"},mt={class:"video-progress-bar"},ft={class:"video-progress-text"},yt={key:1,class:"video-result-container show"},ht=["src"],wt={class:"video-actions"},$t=O({__name:"XhsVideoGenerator",props:{show:{type:Boolean},videoModel:{},videoStyle:{},videoDuration:{},isGenerating:{type:Boolean},showProgress:{type:Boolean},progressPercent:{},progressText:{},videoUrl:{}},emits:["update:videoModel","update:videoStyle","update:videoDuration","generate","download","copy-url"],setup(s){return(i,e)=>s.show?(S(),b("div",it,[e[10]||(e[10]=t("h3",{style:{"margin-bottom":"12px",color:"#333"}},"ğŸ¬ ç”Ÿæˆè®²è§£è§†é¢‘",-1)),e[11]||(e[11]=t("p",{style:{color:"#666","font-size":"14px","margin-bottom":"16px"}}," å°†æ‰€æœ‰å›¾ç‰‡åˆæˆä¸ºä¸€ä¸ªå®Œæ•´çš„åŠ¨ç”»è®²è§£è§†é¢‘ï¼Œé€‚åˆå‘å¸ƒåˆ°å°çº¢ä¹¦ã€æŠ–éŸ³ç­‰å¹³å° ",-1)),t("div",ut,[t("select",{value:s.videoModel,onChange:e[0]||(e[0]=l=>i.$emit("update:videoModel",l.target.value))},[...e[6]||(e[6]=[t("option",{value:"sora2"},"ğŸ¬ Sora2 (æ¨è)",-1),t("option",{value:"veo3"},"ğŸ¥ Veo3",-1)])],40,dt),t("select",{value:s.videoStyle,onChange:e[1]||(e[1]=l=>i.$emit("update:videoStyle",l.target.value))},[...e[7]||(e[7]=[t("option",{value:"ghibli_summer"},"ğŸŒ» å®«å´éªå¤æ—¥é£",-1),t("option",{value:"cartoon"},"ğŸ¨ å¡é€šæ´»æ³¼é£",-1),t("option",{value:"scientific"},"ğŸ”¬ ç§‘æ™®ä¸“ä¸šé£",-1)])],40,ct),t("select",{value:s.videoDuration,onChange:e[2]||(e[2]=l=>i.$emit("update:videoDuration",l.target.value))},[...e[8]||(e[8]=[t("option",{value:"30"},"30 ç§’",-1),t("option",{value:"60"},"60 ç§’",-1),t("option",{value:"90"},"90 ç§’",-1),t("option",{value:"120"},"2 åˆ†é’Ÿ",-1)])],40,vt),t("button",{class:"video-btn",disabled:s.isGenerating,onClick:e[3]||(e[3]=l=>i.$emit("generate"))}," ğŸ¬ "+P(s.isGenerating?"ç”Ÿæˆä¸­...":"ç”Ÿæˆè®²è§£è§†é¢‘"),9,pt)]),s.showProgress?(S(),b("div",gt,[t("div",mt,[t("div",{class:"video-progress-fill",style:A({width:s.progressPercent+"%"})},null,4)]),t("div",ft,P(s.progressText),1)])):M("",!0),s.videoUrl?(S(),b("div",yt,[e[9]||(e[9]=t("h4",{style:{"margin-bottom":"12px",color:"#333"}},"âœ… è®²è§£è§†é¢‘å·²ç”Ÿæˆ",-1)),t("video",{src:s.videoUrl,controls:"",autoplay:"",loop:"",muted:"",playsinline:""},null,8,ht),t("div",wt,[t("button",{onClick:e[4]||(e[4]=l=>i.$emit("download"))},"ğŸ“¥ ä¸‹è½½è§†é¢‘"),t("button",{onClick:e[5]||(e[5]=l=>i.$emit("copy-url"))},"ğŸ“‹ å¤åˆ¶é“¾æ¥")])])):M("",!0)])):M("",!0)}}),bt=U($t,[["__scopeId","data-v-0d047e31"]]),St={class:"publish-modal-content"},Ct=["value"],kt={class:"modal-actions"},Pt=O({__name:"XhsPublishModal",props:{show:{type:Boolean},cookie:{}},emits:["close","update:cookie","publish"],setup(s){return(i,e)=>s.show?(S(),b("div",{key:0,class:"publish-modal",onClick:e[3]||(e[3]=H(l=>i.$emit("close"),["self"]))},[t("div",St,[e[4]||(e[4]=t("h3",null,"ğŸ” è¾“å…¥å°çº¢ä¹¦ Cookie",-1)),e[5]||(e[5]=t("p",null,"åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Network â†’ ä»»æ„è¯·æ±‚ â†’ Headers â†’ Cookieï¼Œå¤åˆ¶ç²˜è´´å³å¯ï¼š",-1)),t("textarea",{value:s.cookie,onInput:e[0]||(e[0]=l=>i.$emit("update:cookie",l.target.value)),placeholder:"ç›´æ¥ç²˜è´´ Cookie å­—ç¬¦ä¸²ï¼Œå¦‚: a1=xxx; webId=yyy; web_session=zzz"},null,40,Ct),t("div",kt,[t("button",{class:"cancel",onClick:e[1]||(e[1]=l=>i.$emit("close"))},"å–æ¶ˆ"),t("button",{class:"confirm",onClick:e[2]||(e[2]=l=>i.$emit("publish"))},"ç¡®è®¤å‘å¸ƒ")])])])):M("",!0)}}),Tt=U(Pt,[["__scopeId","data-v-44fae453"]]),It={class:"terminal-nav"},Mt={class:"terminal-nav-right"},Et={class:"container"},xt={key:0,class:"result-container"},Dt=O({__name:"XhsCreator",setup(s){const i=W(),e=q(),l=Y(()=>e.isDark),a=w(""),f=w("4"),p=w("hand_drawn"),g=w("false"),h=w(!1),$=w(!1),v=oe(),n=ae(),o=ne(),c=le(),d=ie(),m=w(null),E=w([]),x=async()=>{a.value.trim()&&(h.value=!0,$.value=!1,n.reset(),o.initPlaceholders(parseInt(f.value)),$.value=!0,await v.generate({topic:a.value,count:parseInt(f.value),style:p.value,generate_video:g.value==="true"},{onProgress:r=>{n.updateProgress(r.progress,r.message),n.updateStageIndicators(r.stage,r.sub_progress)},onSearch:r=>{var u;n.updateStageDetail("search",`${r.results_count} æ¡ç»“æœ
æ¥æº: ${((u=r.sources)==null?void 0:u.join(", "))||"é€šç”¨"}`)},onOutline:r=>{n.updateStageDetail("outline",`${r.summary||""}
ç‚¹å‡»æŸ¥çœ‹å®Œæ•´å¤§çº²`),m.value=r},onContent:r=>{var u,T;n.updateStageDetail("content",`æ ‡é¢˜: ${((u=r.titles)==null?void 0:u[0])||""}
æ ‡ç­¾: ${((T=r.tags)==null?void 0:T.slice(0,3).join(", "))||""}`)},onStoryboard:r=>{n.updateStageDetail("storyboard",`å…± ${r.total} ä¸ªåˆ†é•œ
æ‚¬æµ®å›¾ç‰‡æŸ¥çœ‹è§†è§‰æŒ‡ä»¤`),E.value=r.prompts||[],r.prompts&&o.setImagePrompts(r.prompts)},onImageProgress:r=>{r.status==="generating"?o.updateImageStatus(r.index,`ç¬¬ ${r.index+1} é¡µ ç”Ÿæˆä¸­...`):r.status==="failed"&&o.updateImageStatus(r.index,`ç¬¬ ${r.index+1} é¡µ å¤±è´¥`)},onImage:r=>{o.setImageUrl(r.index,r.url)},onVideo:r=>{n.updateStageDetail("video","åŠ¨ç”»å°é¢å·²ç”Ÿæˆ")},onComplete:r=>{n.markComplete(),o.ensureAllImagesLoaded(r.image_urls||[]),setTimeout(()=>{h.value=!1},3e3)},onError:r=>{n.markError(r),setTimeout(()=>{h.value=!1},5e3)},onCancelled:()=>{n.markCancelled(),setTimeout(()=>{h.value=!1},3e3)}}))},j=async()=>{await v.cancel()},B=()=>{d.copyCopywriting(v.currentResult.value)},C=()=>{var u;const r=(u=v.currentResult.value)==null?void 0:u.image_urls;r&&o.downloadAll(r)},I=async()=>{var T,k,R;const r=(T=v.currentResult.value)==null?void 0:T.image_urls;if(!r)return;const u=[];for((k=m.value)!=null&&k.pages?m.value.pages.forEach(X=>u.push(X.content||"")):(R=v.currentResult.value)!=null&&R.pages&&v.currentResult.value.pages.forEach(X=>u.push(X.content||""));u.length<r.length;)u.push("");await c.generate(r,u)},D=async()=>{const r=await d.publish(v.currentResult.value);r.success?(alert("ğŸ‰ å‘å¸ƒæˆåŠŸï¼"+(r.url?`
ç¬”è®°é“¾æ¥: `+r.url:"")),d.closeModal()):alert("âŒ å‘å¸ƒå¤±è´¥: "+r.error)},N=(r,u)=>{o.imageSlots.value[r]&&(o.imageSlots.value[r].showTooltip=u)},V=async r=>{try{const u=await Z(r);if(u.success&&u.record){const T=u.record;a.value=T.topic||"";let k=[];try{k=JSON.parse(T.xhs_image_urls||"[]")}catch{}let R=[];try{R=JSON.parse(T.xhs_hashtags||"[]")}catch{}v.currentResult.value={id:T.id,topic:T.topic,image_urls:k,video_url:T.cover_video||"",titles:[T.topic],copywriting:T.xhs_copy_text||"",tags:R},o.loadFromHistory(k),$.value=!0}}catch(u){console.error("åŠ è½½å°çº¢ä¹¦å†å²è¯¦æƒ…å¤±è´¥:",u),alert("åŠ è½½å†å²è®°å½•å¤±è´¥")}};return F(()=>{const r=i.query.topic,u=i.query.source_id,T=i.query.history_id;r&&(a.value=r),u&&(window.xhsSourceId=u),T&&V(T)}),(r,u)=>{const T=ee("router-link");return S(),b("div",{class:J(["xhs-container",{"dark-mode":l.value}])},[t("nav",It,[u[11]||(u[11]=K('<div class="terminal-nav-left" data-v-18b802ef><div class="terminal-dots" data-v-18b802ef><span class="dot red" data-v-18b802ef></span><span class="dot yellow" data-v-18b802ef></span><span class="dot green" data-v-18b802ef></span></div><span class="terminal-title" data-v-18b802ef>$ xhs-creator --generate</span></div>',1)),t("div",Mt,[u[10]||(u[10]=t("a",{href:"https://github.com/datawhalechina/vibe-blog",target:"_blank",rel:"noopener noreferrer",class:"nav-cmd",title:"GitHub - vibe-blog"}," GitHub ",-1)),_(T,{to:"/",class:"nav-cmd"},{default:Q(()=>[...u[9]||(u[9]=[te("cd ~/blog",-1)])]),_:1}),t("button",{class:"theme-toggle",onClick:u[0]||(u[0]=k=>y(e).toggleTheme())},P(l.value?"â˜€ï¸":"ğŸŒ™"),1)])]),t("div",Et,[u[12]||(u[12]=t("div",{class:"page-title"},[t("h1",null,"> å°çº¢ä¹¦åˆ›ä½œåŠ©æ‰‹_"),t("p",{class:"code-comment"},"// è¾“å…¥ä¸»é¢˜ï¼Œä¸€é”®ç”Ÿæˆå°çº¢ä¹¦é£æ ¼ä¿¡æ¯å›¾ç³»åˆ—")],-1)),_(Se,{topic:a.value,"onUpdate:topic":u[1]||(u[1]=k=>a.value=k),"page-count":f.value,"onUpdate:pageCount":u[2]||(u[2]=k=>f.value=k),"visual-style":p.value,"onUpdate:visualStyle":u[3]||(u[3]=k=>p.value=k),"generate-video":g.value,"onUpdate:generateVideo":u[4]||(u[4]=k=>g.value=k),"is-loading":y(v).isLoading.value,"error-msg":y(v).errorMsg.value,onGenerate:x},null,8,["topic","page-count","visual-style","generate-video","is-loading","error-msg"]),_(Je,{show:h.value,"progress-percent":y(n).progressPercent.value,"progress-title":y(n).progressTitle.value,"current-stage-text":y(n).currentStageText.value,"time-estimate":y(n).timeEstimate.value,"image-sub-progress":y(n).imageSubProgress.value,stages:y(n).stages,"stage-statuses":y(n).stageStatuses,"stage-details":y(n).stageDetails,"get-stage-class":y(n).getStageClass,"get-stage-status":y(n).getStageStatus,onCancel:j},null,8,["show","progress-percent","progress-title","current-stage-text","time-estimate","image-sub-progress","stages","stage-statuses","stage-details","get-stage-class","get-stage-status"]),$.value?(S(),b("div",xt,[_(Ye,{show:$.value,"image-slots":y(o).imageSlots.value,onCopyPrompt:y(o).copyPrompt,onUpdateTooltip:N},null,8,["show","image-slots","onCopyPrompt"]),_(rt,{show:$.value,result:y(v).currentResult.value,onCopyCopywriting:B,onDownloadImages:C,onOpenPublish:y(d).openModal},null,8,["show","result","onOpenPublish"]),_(bt,{show:$.value,"video-model":y(c).videoModel.value,"onUpdate:videoModel":u[5]||(u[5]=k=>y(c).videoModel.value=k),"video-style":y(c).videoStyle.value,"onUpdate:videoStyle":u[6]||(u[6]=k=>y(c).videoStyle.value=k),"video-duration":y(c).videoDuration.value,"onUpdate:videoDuration":u[7]||(u[7]=k=>y(c).videoDuration.value=k),"is-generating":y(c).isGenerating.value,"show-progress":y(c).showProgress.value,"progress-percent":y(c).progressPercent.value,"progress-text":y(c).progressText.value,"video-url":y(c).videoUrl.value,onGenerate:I,onDownload:y(c).download,onCopyUrl:y(c).copyUrl},null,8,["show","video-model","video-style","video-duration","is-generating","show-progress","progress-percent","progress-text","video-url","onDownload","onCopyUrl"])])):M("",!0)]),_(Tt,{show:y(d).showModal.value,cookie:y(d).cookieInput.value,"onUpdate:cookie":u[8]||(u[8]=k=>y(d).cookieInput.value=k),onClose:y(d).closeModal,onPublish:D},null,8,["show","cookie","onClose"]),_(se)],2)}}}),Ot=U(Dt,[["__scopeId","data-v-18b802ef"]]);export{Ot as default};
