const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-Cd26h607.js","assets/index-DPWOLYNa.js","assets/index-Cm827VRf.css"])))=>i.map(i=>d[i]);
import{H as re,I as Te,J as Ce,K as Ee,h as f,E as Le,G as fe,d as ce,q as pe,c as v,a as e,n as le,F as J,r as te,g as O,o as d,t as T,_ as ue,p as Se,i as se,m as ye,L as Ie,T as De,C as he,f as ve,M as we,b as ie,s as w,P as Me,v as Be,x as Oe,B as qe,N as Pe,D as Re}from"./index-DPWOLYNa.js";import{u as We}from"./useMarkdownRenderer-BVm5dxoM.js";import"./marked.esm-CURnbxgz.js";function ze(){const t=f(!1),g=f(!1),o=f([]),h=f(""),n=f(""),l=f(""),k=f(""),L=f(null),$=f(!1),x=f([]),r=f(""),p=f(-1);let u=0,i=null,y="",S="",W="",B=null;const V=I=>{B||(B=setTimeout(()=>{k.value=I,B=null},100))},m=(I,D="info",_)=>{o.value.push({time:new Date().toLocaleTimeString(),message:I,type:D,..._?{detail:_}:{}})},z=I=>{const D=o.value.find(_=>_.type==="stream");D?D.message=I:m(I,"stream")},q=I=>({start:"ðŸš€",research:"ðŸ”",plan:"ðŸ“‹",write:"âœï¸",code:"ðŸ’»",review:"âœ…",image:"ðŸŽ¨",assemble:"ðŸ“¦",complete:"ðŸŽ‰",error:"âŒ"})[I]||"â—‹",F=(I,D)=>{y="",S="",W="",k.value="",x.value=[],r.value="";const _=Ee(I);i=_,_.addEventListener("connected",()=>{m("ðŸ”— å·²è¿žæŽ¥åˆ°æœåŠ¡å™¨"),n.value="è¿è¡Œä¸­"}),_.addEventListener("progress",C=>{const c=JSON.parse(C.data),s=q(c.stage);m(`${s} ${c.message}`,c.stage==="error"?"error":"info"),h.value=c.message}),_.addEventListener("log",C=>{var H,A;const c=JSON.parse(C.data);let s="ðŸ“";s={generator:"âš™ï¸",researcher:"ðŸ”",planner:"ðŸ“‹",writer:"âœï¸",questioner:"â“",coder:"ðŸ’»",artist:"ðŸŽ¨",reviewer:"âœ…",assembler:"ðŸ“¦",search_service:"ðŸŒ",blog_service:"ðŸ–¼ï¸"}[c.logger]||s;const N=((H=c.message)==null?void 0:H.includes("å®Œæˆ"))||((A=c.message)==null?void 0:A.includes("æˆåŠŸ"));m(`${s} ${c.message}`,N?"success":"info"),h.value=c.message}),_.addEventListener("stream",C=>{const c=JSON.parse(C.data);c.stage==="outline"&&z(c.accumulated)}),_.addEventListener("outline_ready",C=>{const c=JSON.parse(C.data);L.value={title:c.title||"",sections_titles:c.sections_titles||[],sections:c.sections||[]},$.value=!0,m("ðŸ“‹ å¤§çº²å·²ç”Ÿæˆï¼Œç­‰å¾…ç¡®è®¤...","info"),h.value="ç­‰å¾…å¤§çº²ç¡®è®¤"}),_.addEventListener("writing_chunk",C=>{const c=JSON.parse(C.data),s=c.section_title||"";s&&s!==W&&(W&&(S=y),W=s,u++,p.value=u-1),c.accumulated?(y=S?S+`

`+c.accumulated:c.accumulated,V(y)):c.delta&&(y+=c.delta,V(y))}),_.addEventListener("result",C=>{var j,N,H,A,Y,X,ae,oe;const c=JSON.parse(C.data),s=c.data||{};switch(c.type){case"search_started":o.value.push({time:new Date().toLocaleTimeString(),message:`ðŸ” æœç´¢: ${s.query||""}`,type:"search",data:{query:s.query,searching:!0}});break;case"search_results":{let E=-1;for(let M=o.value.length-1;M>=0;M--){const R=o.value[M];if(R.type==="search"&&((j=R.data)!=null&&j.searching)){if(((N=R.data)==null?void 0:N.query)===s.query){E=M;break}E<0&&(E=M)}}E>=0?o.value[E]={time:new Date().toLocaleTimeString(),message:`ðŸ” ${s.query||"æœç´¢ç»“æžœ"}`,type:"search",data:s}:o.value.push({time:new Date().toLocaleTimeString(),message:`ðŸ” ${s.query||"æœç´¢ç»“æžœ"}`,type:"search",data:s});break}case"crawl_completed":s.url?o.value.push({time:new Date().toLocaleTimeString(),message:`ðŸ“– æ­£åœ¨é˜…è¯»: ${s.title||s.url}`,type:"crawl",data:s}):s.count&&m(`ðŸ“– æ·±åº¦æŠ“å–å®Œæˆ: ${s.count} ç¯‡é«˜è´¨é‡ç´ æ`,"success");break;case"search_completed":for(let E=o.value.length-1;E>=0;E--){const M=o.value[E];M.type==="search"&&((H=M.data)!=null&&H.searching)&&(o.value[E]={time:new Date().toLocaleTimeString(),message:`âœ… æœç´¢å®Œæˆ: ${((A=M.data)==null?void 0:A.query)||""}`,type:"success"})}m(`âœ… ${s.message||"æœç´¢å®Œæˆ"}`,"success");break;case"researcher_complete":for(let E=o.value.length-1;E>=0;E--){const M=o.value[E];M.type==="search"&&((Y=M.data)!=null&&Y.searching)&&o.value.splice(E,1)}(s.document_count>0||s.web_count>0)&&m(`ðŸ“Š çŸ¥è¯†æ¥æº: æ–‡æ¡£ ${s.document_count} æ¡, ç½‘ç»œ ${s.web_count} æ¡`,"info"),((X=s.key_concepts)==null?void 0:X.length)>0&&m(`ðŸ’¡ æ ¸å¿ƒæ¦‚å¿µ: ${s.key_concepts.join(", ")}`,"success");break;case"outline_complete":if(((ae=s.sections_titles)==null?void 0:ae.length)>0){const E=s.sections_titles.map((M,R)=>`${R+1}. ${M}`).join(`
`);m(`ðŸ“‹ å¤§çº²: ${s.title}`,"success",E)}break;case"section_complete":m(`âœï¸ ç« èŠ‚ ${s.section_index} å®Œæˆ: ${s.title} (${s.content_length} å­—)`,"success");break;case"check_knowledge_complete":s.gaps_count>0&&m(`ðŸ”Ž çŸ¥è¯†ç©ºç™½: ${s.gaps_count} ä¸ª (æœç´¢ ${s.search_count}/${s.max_search_count})`,"info",(oe=s.gaps)==null?void 0:oe.join(`
`));break;case"refine_search_complete":m(`ðŸŒ ç¬¬ ${s.round} è½®æœç´¢: èŽ·å– ${s.results_count} æ¡ç»“æžœ`,"info");break;case"enhance_knowledge_complete":m(`ðŸ“š å†…å®¹å¢žå¼ºå®Œæˆ: ç´¯ç§¯çŸ¥è¯† ${s.knowledge_length} å­—`,"success");break;case"questioner_complete":m(s.needs_deepen?"â“ å†…å®¹éœ€è¦æ·±åŒ–":"âœ… å†…å®¹æ·±åº¦æ£€æŸ¥é€šè¿‡",s.needs_deepen?"info":"success");break;case"coder_complete":m(`ðŸ’» ä»£ç ç¤ºä¾‹: ${s.code_blocks_count} ä¸ªä»£ç å—`,"success");break;case"artist_complete":m(`ðŸŽ¨ é…å›¾æè¿°: ${s.images_count} å¼ `,"success");break;case"reviewer_complete":m(`âœ… è´¨é‡å®¡æ ¸: ${s.score} åˆ† ${s.passed?"é€šè¿‡":"éœ€ä¿®è®¢"}`,s.passed?"success":"warning");break;case"assembler_complete":m(`ðŸ“¦ æ–‡æ¡£ç»„è£…å®Œæˆ: ${s.markdown_length} å­—`,"success");break;default:s.message&&m(`ðŸ“Œ ${s.message}`,"info")}}),_.addEventListener("complete",C=>{const c=JSON.parse(C.data);m("ðŸŽ‰ ç”Ÿæˆå®Œæˆï¼","success"),n.value="å·²å®Œæˆ",h.value="ç”Ÿæˆå®Œæˆ",t.value=!1,c.citations&&(x.value=c.citations),c.markdown&&(k.value=c.markdown),r.value=c.id||c.book_id||"",_.close(),i=null,D==null||D(c)}),_.addEventListener("error",C=>{if(C.data){const c=JSON.parse(C.data);m(`âŒ é”™è¯¯: ${c.message}`,"error")}n.value="é”™è¯¯",t.value=!1}),_.onerror=()=>{_.readyState===EventSource.CLOSED&&(m("ðŸ”Œ è¿žæŽ¥å·²å…³é—­"),t.value=!1)}},G=async I=>{if(l.value){$.value=!1;try{(await Ce(l.value,I)).success&&(m(I==="accept"?"âœ“ å¤§çº²å·²ç¡®è®¤ï¼Œå¼€å§‹å†™ä½œ":"âœ“ å¤§çº²å·²ä¿®æ”¹ï¼Œé‡æ–°è§„åˆ’","success"),h.value="å†™ä½œä¸­...")}catch(D){m(`âœ— å¤§çº²ç¡®è®¤å¤±è´¥: ${D.message}`,"error")}}},K=async()=>{if(l.value)try{const I=await Te(l.value);I.success?m("â¹ï¸ ä»»åŠ¡å·²å–æ¶ˆ","error"):m(`âš ï¸ å–æ¶ˆå¤±è´¥: ${I.error}`,"error")}catch{m("âš ï¸ å–æ¶ˆè¯·æ±‚å¤±è´¥","error")}i==null||i.close(),i=null,n.value="å·²åœæ­¢",t.value=!1},U=()=>{g.value=!1,i==null||i.close(),i=null},Q=()=>{t.value=!1,g.value=!1,o.value=[],h.value="",n.value="",l.value="",k.value="",L.value=null,$.value=!1,x.value=[],r.value="",y="",S="",W="",p.value=-1,u=0};return re(()=>{i==null||i.close(),i=null,B&&(clearTimeout(B),B=null)}),{isLoading:t,showProgress:g,progressItems:o,progressText:h,statusBadge:n,currentTaskId:l,previewContent:k,outlineData:L,waitingForOutline:$,citations:x,completedBlogId:r,activeSectionIndex:p,connectSSE:F,confirmOutline:G,stopGeneration:K,closeProgress:U,addProgressItem:m,reset:Q}}function Ne(){const t=f(!1);function g(r,p){const u=URL.createObjectURL(r),i=document.createElement("a");i.href=u,i.download=p,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(u)}function o(r){return r.replace(/[^a-zA-Z0-9\u4e00-\u9fa5_-]/g,"_").substring(0,50)}function h(r,p){const u=new Blob([r],{type:"text/markdown;charset=utf-8"});g(u,`${o(p)}.md`)}function n(r,p){let u=r.replace(/^### (.*$)/gm,"<h3>$1</h3>").replace(/^## (.*$)/gm,"<h2>$1</h2>").replace(/^# (.*$)/gm,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>");const i=`<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${p}</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem; line-height: 1.8; color: #333; }
  h1, h2, h3 { color: #1a1a1a; margin-top: 1.5em; }
  code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-size: 0.9em; }
  pre { background: #f4f4f4; padding: 1rem; border-radius: 6px; overflow-x: auto; }
  img { max-width: 100%; border-radius: 8px; }
  a { color: #0066cc; }
</style>
</head>
<body>
<p>${u}</p>
</body>
</html>`,y=new Blob([i],{type:"text/html;charset=utf-8"});g(y,`${o(p)}.html`)}function l(r,p){const u=r.replace(/^#{1,6}\s/gm,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/`([^`]+)`/g,"$1").replace(/```[\s\S]*?```/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/\[([^\]]+)\]\(.*?\)/g,"$1"),i=new Blob([u],{type:"text/plain;charset=utf-8"});g(i,`${o(p)}.txt`)}async function k(r,p){const u=He(r),{jsPDF:i}=await fe(async()=>{const{jsPDF:z}=await import("./jspdf.es.min-Cd26h607.js").then(q=>q.j);return{jsPDF:z}},__vite__mapDeps([0,1,2])),y=new i({unit:"mm",format:"a4"});try{y.setFont("helvetica")}catch{}let S=20;const W=280,B=7,V=15,m=180;for(const z of u){let q=11;z.type==="h1"?q=18:z.type==="h2"?q=15:z.type==="h3"?q=13:z.type==="list"&&(q=11),y.setFontSize(q);const F=y.splitTextToSize(z.text,m);for(const G of F)S>W&&(y.addPage(),S=20),y.text(G,V,S),S+=B;S+=2}y.save(`${o(p)}.pdf`)}async function L(r,p){const u=document.getElementById(r);if(!u)throw new Error(`Element #${r} not found`);const i=(await fe(async()=>{const{default:S}=await import("./html2canvas.esm-CBrSDip1.js");return{default:S}},[])).default;(await i(u,{scale:2,useCORS:!0,windowHeight:u.scrollHeight})).toBlob(S=>{S&&g(S,`${o(p)}.png`)},"image/png")}async function $(r,p){const u=await fetch("/api/export/word",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({markdown:r,title:p})});if(!u.ok){const y=await u.json().catch(()=>({error:"å¯¼å‡ºå¤±è´¥"}));throw new Error(y.error||"å¯¼å‡ºå¤±è´¥")}const i=await u.blob();g(i,`${o(p)}.docx`)}async function x(r,p,u){if(!(!p||t.value)){t.value=!0;try{switch(r){case"markdown":h(p,u);break;case"html":n(p,u);break;case"txt":l(p,u);break;case"word":await $(p,u);break;case"pdf":await k(p,u);break;case"image":await L("preview-content",u);break}}finally{t.value=!1}}}return{isDownloading:Le(t),exportAs:x,exportMarkdown:h,exportHtml:n,exportTxt:l,exportWord:$,exportPdf:k,exportImage:L}}function He(t){const g=t.split(`
`),o=[];for(const h of g){const n=h.trim();n&&(n.startsWith("### ")?o.push({type:"h3",text:n.slice(4)}):n.startsWith("## ")?o.push({type:"h2",text:n.slice(3)}):n.startsWith("# ")?o.push({type:"h1",text:n.slice(2)}):n.startsWith("- ")||n.startsWith("* ")?o.push({type:"list",text:`â€¢ ${n.slice(2)}`}):o.push({type:"paragraph",text:Ae(n)}))}return o}function Ae(t){return t.replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/`([^`]+)`/g,"$1").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1")}function be(t){try{return decodeURIComponent(t).replace(/\/+$/,"").toLowerCase()}catch{return t.replace(/\/+$/,"").toLowerCase()}}function Fe(t,g){if(!t||!(g!=null&&g.length))return null;const o=be(t);for(const h of g)if(be(h.url)===o)return h;return null}function Ue(t,g){if(!t||!(g!=null&&g.length))return[];const o=t.querySelectorAll("a[href]"),h=[];return o.forEach(n=>{const l=n.getAttribute("href")||"";if(!l.startsWith("http"))return;const k=Fe(l,g);if(k){const L=g.indexOf(k)+1;h.push({element:n,citation:k,index:L})}}),h}const je={key:0,class:"export-spinner"},Je={key:1},Ve={key:0,class:"export-menu"},Ge=["onClick"],Qe={class:"export-item-num"},Ze={class:"export-item-label"},Ke={class:"export-item-ext"},Ye=ce({__name:"ExportMenu",props:{content:{},filename:{},isDownloading:{type:Boolean,default:!1},menuOpen:{type:Boolean,default:!1}},emits:["export"],setup(t,{emit:g}){const o=t,h=g,n=f(o.menuOpen),l=f(null),k=r=>{l.value&&!l.value.contains(r.target)&&(n.value=!1)};pe(()=>document.addEventListener("click",k,!0)),re(()=>document.removeEventListener("click",k,!0));const L=[{id:"markdown",label:"Markdown",ext:".md"},{id:"html",label:"HTML",ext:".html"},{id:"text",label:"çº¯æ–‡æœ¬",ext:".txt"},{id:"pdf",label:"PDF",ext:".pdf"},{id:"word",label:"Word",ext:".docx"}],$=()=>{o.isDownloading||!o.content||(n.value=!n.value)},x=r=>{h("export",r),n.value=!1};return(r,p)=>(d(),v("div",{class:"export-wrapper",ref_key:"wrapperRef",ref:l},[e("button",{class:le(["export-trigger",{downloading:t.isDownloading}]),onClick:$},[t.isDownloading?(d(),v("span",je,"â—")):(d(),v("span",Je,"â¬‡ï¸")),p[0]||(p[0]=e("span",null,"å¯¼å‡º",-1))],2),n.value?(d(),v("div",Ve,[p[1]||(p[1]=e("div",{class:"export-menu-header"},"$ export --format",-1)),(d(),v(J,null,te(L,(u,i)=>e("button",{key:u.id,class:"export-item",onClick:y=>x(u.id)},[e("span",Qe,"["+T(i+1)+"]",1),e("span",Ze,T(u.label),1),e("span",Ke,T(u.ext),1)],8,Ge)),64))])):O("",!0)],512))}}),Xe=ue(Ye,[["__scopeId","data-v-8ad41b9c"]]),et={class:"quality-dialog"},tt={key:0,class:"quality-loading"},st={class:"quality-header"},at={class:"quality-grade"},ot={class:"quality-overall"},nt={class:"quality-scores"},it={class:"score-label"},lt={class:"score-bar"},rt={class:"score-value"},ct={class:"quality-stats"},ut={class:"stat-item"},dt={class:"stat-item"},vt={class:"stat-item"},pt={class:"stat-item"},mt={key:0,class:"quality-list strengths"},gt={key:1,class:"quality-list weaknesses"},ft={key:2,class:"quality-list suggestions"},ht={class:"quality-summary"},wt=ce({__name:"QualityDialog",props:{visible:{type:Boolean},evaluation:{},loading:{type:Boolean}},emits:["close"],setup(t){const g=t,o={factual_accuracy:"äº‹å®žå‡†ç¡®",completeness:"å†…å®¹å®Œæ•´",coherence:"é€»è¾‘è¿žè´¯",relevance:"ä¸»é¢˜ç›¸å…³",citation_quality:"å¼•ç”¨è´¨é‡",writing_quality:"å†™ä½œè´¨é‡"},h=se(()=>{var l;const n=((l=g.evaluation)==null?void 0:l.grade)||"";return n==="N/A"?"grade-poor":n.startsWith("A")?"grade-excellent":n.startsWith("B")?"grade-good":n.startsWith("C")?"grade-average":"grade-poor"});return(n,l)=>{var k,L,$;return t.visible?(d(),v("div",{key:0,class:"quality-dialog-overlay",onClick:l[1]||(l[1]=Se(x=>n.$emit("close"),["self"]))},[e("div",et,[t.loading?(d(),v("div",tt,[...l[2]||(l[2]=[e("span",{class:"loading-spinner"},"â—",-1),e("span",{class:"loading-text"},"$ evaluate --verbose",-1)])])):t.evaluation?(d(),v(J,{key:1},[e("div",st,[e("div",at,[e("span",{class:le(["grade-badge",h.value])},T(t.evaluation.grade),3),e("span",ot,T(t.evaluation.overall_score)+"/100",1)]),e("button",{class:"dialog-close-btn",onClick:l[0]||(l[0]=x=>n.$emit("close"))},"âœ•")]),e("div",nt,[(d(),v(J,null,te(o,(x,r)=>e("div",{key:r,class:"score-row"},[e("span",it,T(x),1),e("div",lt,[e("div",{class:"score-bar-fill",style:ye({width:`${t.evaluation.scores[r]}%`})},null,4)]),e("span",rt,T(t.evaluation.scores[r])+"%",1)])),64))]),e("div",ct,[e("span",ut,"ðŸ“ "+T(t.evaluation.word_count)+" å­—",1),e("span",dt,"ðŸ“Ž "+T(t.evaluation.citation_count)+" å¼•ç”¨",1),e("span",vt,"ðŸ–¼ï¸ "+T(t.evaluation.image_count)+" å›¾ç‰‡",1),e("span",pt,"ðŸ’» "+T(t.evaluation.code_block_count)+" ä»£ç å—",1)]),(k=t.evaluation.strengths)!=null&&k.length?(d(),v("div",mt,[l[3]||(l[3]=e("div",{class:"list-title"},"âœ“ ä¼˜ç‚¹",-1)),(d(!0),v(J,null,te(t.evaluation.strengths,(x,r)=>(d(),v("div",{key:r,class:"list-item"},T(x),1))),128))])):O("",!0),(L=t.evaluation.weaknesses)!=null&&L.length?(d(),v("div",gt,[l[4]||(l[4]=e("div",{class:"list-title"},"âœ— ä¸è¶³",-1)),(d(!0),v(J,null,te(t.evaluation.weaknesses,(x,r)=>(d(),v("div",{key:r,class:"list-item"},T(x),1))),128))])):O("",!0),($=t.evaluation.suggestions)!=null&&$.length?(d(),v("div",ft,[l[5]||(l[5]=e("div",{class:"list-title"},"â†’ å»ºè®®",-1)),(d(!0),v(J,null,te(t.evaluation.suggestions,(x,r)=>(d(),v("div",{key:r,class:"list-item"},T(x),1))),128))])):O("",!0),e("div",ht,T(t.evaluation.summary),1)],64)):O("",!0)])])):O("",!0)}}}),bt=ue(wt,[["__scopeId","data-v-da095d7c"]]),yt={class:"citation-index"},kt={class:"citation-domain"},$t={class:"citation-title"},xt={class:"citation-snippet"},_t={class:"citation-footer"},Tt={key:0,class:"citation-relevance"},Ct=["href"],Et=ce({__name:"CitationTooltip",props:{visible:{type:Boolean},citation:{},index:{},position:{}},emits:["keep-visible","request-hide"],setup(t,{emit:g}){const o=g,h=f(window.innerWidth),n=se(()=>h.value<768);function l(){h.value=window.innerWidth}pe(()=>window.addEventListener("resize",l)),re(()=>window.removeEventListener("resize",l));function k(){o("keep-visible")}function L(){o("request-hide")}return($,x)=>(d(),Ie(De,{to:"body"},[t.visible&&t.citation&&!n.value?(d(),v("div",{key:0,class:"citation-tooltip",style:ye({top:t.position.top+"px",left:t.position.left+"px"}),onMouseenter:k,onMouseleave:L},[e("div",yt,"["+T(t.index)+"]",1),e("div",kt,T(t.citation.domain),1),e("div",$t,T(t.citation.title),1),e("div",xt,T(t.citation.snippet),1),e("div",_t,[t.citation.relevance?(d(),v("span",Tt," â­ ç›¸å…³æ€§: "+T(t.citation.relevance)+"% ",1)):O("",!0),e("a",{href:t.citation.url,target:"_blank",class:"citation-link"},"ðŸ”— æ‰“å¼€åŽŸæ–‡",8,Ct)])],36)):O("",!0)]))}}),Lt=ue(Et,[["__scopeId","data-v-b6fb44eb"]]),St={class:"generate-container"},It={class:"generate-main"},Dt={class:"generate-left"},Mt={class:"generate-right"},Bt={class:"research-card"},Ot={class:"card-toolbar"},qt={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Pt={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Rt={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Wt={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},zt=["disabled"],Nt={class:"card-tab-content"},Ht={class:"report-scroll"},At=["innerHTML"],Ft={key:2,class:"preview-empty"},Ut={key:3,class:"loading-dots"},jt={key:4,class:"preview-footer"},Jt={key:0,class:"mobile-tabs"},Vt=["disabled"],Gt=ce({__name:"Generate",setup(t){const g=Oe(),o=qe(),h=f(window.innerWidth),n=se(()=>h.value<768),l=f("activity"),k=f("activities");function L(){h.value=window.innerWidth}const{isLoading:$,progressItems:x,progressText:r,statusBadge:p,currentTaskId:u,previewContent:i,outlineData:y,waitingForOutline:S,citations:W,completedBlogId:B,activeSectionIndex:V,connectSSE:m,confirmOutline:z,stopGeneration:q,addProgressItem:F}=ze(),G=Ne(),K=f(!1),U=f(!1),Q=f(""),{renderMarkdown:I}=We(),D=f(null),_=["#3b82f6","#10b981","#f59e0b","#8b5cf6","#ec4899","#06b6d4","#ef4444","#84cc16"],C=se(()=>{const b=I(i.value);if(!b)return"";let a=0;return b.replace(/<h2([\s>])/g,(P,ne)=>{const ee=_[a%_.length],_e=`<h2 class="${$.value&&a===V.value?"section-heading section-active":"section-heading"}" style="border-bottom: 3px solid ${ee}; padding-bottom: 4px;" data-section="${a}"${ne}`;return a++,_e})}),c=se(()=>{var b;return((b=y.value)==null?void 0:b.title)||"åšå®¢"}),s=f(!1),j=f(null),N=f(!1),H=f(!1),A=f(null),Y=f(0),X=f({top:0,left:0}),ae=()=>{U.value?(Q.value="",U.value=!1):(Q.value=i.value,U.value=!0)},oe=async()=>{i.value&&(await navigator.clipboard.writeText(i.value),K.value=!0,setTimeout(()=>{K.value=!1},1500))},E=b=>{const a={markdown:"markdown",html:"html",text:"txt",word:"word",pdf:"pdf"};G.exportAs(a[b]||"markdown",i.value,c.value)},M=async()=>{if(!(!B.value||N.value)){N.value=!0,s.value=!0,j.value=null;try{const b=await Pe(B.value);b.success&&b.evaluation&&(j.value=b.evaluation)}catch(b){F(`è¯„ä¼°å¤±è´¥: ${b.message}`,"error"),s.value=!1}finally{N.value=!1}}};let R=null,Z=null;const ke=(b,a,P)=>{Z&&(clearTimeout(Z),Z=null),R=setTimeout(()=>{H.value=!0,A.value=b,Y.value=a,X.value={top:P.bottom+8,left:P.left}},200)},$e=()=>{R&&(clearTimeout(R),R=null),Z=setTimeout(()=>{H.value=!1},100)},xe=()=>{if(!D.value||!W.value.length)return;Ue(D.value,W.value).forEach(({element:a,citation:P,index:ne})=>{a.addEventListener("mouseenter",()=>{const ee=a.getBoundingClientRect();ke(P,ne,ee)}),a.addEventListener("mouseleave",()=>{$e()}),a.addEventListener("click",ee=>{const ge=`ref-${ne}`,de=document.getElementById(ge);de&&(ee.preventDefault(),de.scrollIntoView({behavior:"smooth",block:"start"}))})})};he([C,W],()=>{Re(()=>xe())}),he(i,(b,a)=>{b&&!a&&(k.value="report",n.value&&(l.value="preview"))});const me=()=>{o.push("/")};return pe(()=>{window.addEventListener("resize",L);const b=g.params.taskId;b&&(u.value=b,$.value=!0,F(`ä»»åŠ¡ ${b} å·²è¿žæŽ¥`),m(b,a=>{a.id&&F("æ–‡ç« å·²ç”Ÿæˆï¼Œå¯ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…")}))}),re(()=>{window.removeEventListener("resize",L),H.value=!1,R&&clearTimeout(R),Z&&clearTimeout(Z)}),(b,a)=>(d(),v("div",St,[e("div",It,[ve(e("div",Dt,[ie(Me,{visible:!0,expanded:!0,embedded:!0,"is-loading":w($),"status-badge":w(p),"progress-text":w(r),"progress-items":w(x),"article-type":"blog","target-length":"","task-id":w(u),"outline-data":w(y),"waiting-for-outline":w(S),"preview-content":w(i),onClose:me,onStop:w(q),onToggle:()=>{},onConfirmOutline:w(z)},null,8,["is-loading","status-badge","progress-text","progress-items","task-id","outline-data","waiting-for-outline","preview-content","onStop","onConfirmOutline"])],512),[[we,!n.value||l.value==="activity"]]),ve(e("div",Mt,[e("div",Bt,[e("div",Ot,[w($)?(d(),v("button",{key:0,class:"icon-btn stop-btn",title:"åœæ­¢",onClick:a[0]||(a[0]=(...P)=>w(q)&&w(q)(...P))},[...a[6]||(a[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"})],-1)])])):O("",!0),w(i)&&!w($)?(d(),v(J,{key:1},[e("button",{class:"icon-btn",title:"ç¼–è¾‘",onClick:ae},[U.value?(d(),v("svg",Pt,[...a[8]||(a[8]=[e("path",{d:"M3 7v6h6"},null,-1),e("path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"},null,-1)])])):(d(),v("svg",qt,[...a[7]||(a[7]=[e("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"},null,-1)])]))]),e("button",{class:"icon-btn",title:"å¤åˆ¶",onClick:oe},[K.value?(d(),v("svg",Wt,[...a[10]||(a[10]=[e("path",{d:"M20 6 9 17l-5-5"},null,-1)])])):(d(),v("svg",Rt,[...a[9]||(a[9]=[e("rect",{width:"14",height:"14",x:"8",y:"8",rx:"2"},null,-1),e("path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"},null,-1)])]))]),w(B)?(d(),v("button",{key:0,class:"icon-btn",title:"è´¨é‡è¯„ä¼°",disabled:N.value,onClick:M},[...a[11]||(a[11]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 10v6M2 10l10-5 10 5-10 5z"}),e("path",{d:"M6 12v5c3 3 9 3 12 0v-5"})],-1)])],8,zt)):O("",!0),ie(Xe,{content:w(i),filename:c.value,"is-downloading":w(G).isDownloading.value,onExport:E},null,8,["content","filename","is-downloading"])],64)):O("",!0),e("button",{class:"icon-btn",title:"å…³é—­",onClick:me},[...a[12]||(a[12]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6 6 18"}),e("path",{d:"m6 6 12 12"})],-1)])])]),a[17]||(a[17]=e("div",{class:"card-tabs"},[e("div",{class:"card-tabs-list"},[e("span",{class:"card-tab active"},"æŠ¥å‘Š")])],-1)),e("div",Nt,[e("div",Ht,[a[15]||(a[15]=e("div",{class:"scroll-shadow scroll-shadow-top"},null,-1)),a[16]||(a[16]=e("div",{class:"scroll-shadow scroll-shadow-bottom"},null,-1)),U.value?ve((d(),v("textarea",{key:0,"onUpdate:modelValue":a[1]||(a[1]=P=>Q.value=P),class:"edit-textarea"},null,512)),[[Be,Q.value]]):w(i)?(d(),v("div",{key:1,id:"preview-content",ref_key:"previewRef",ref:D,class:"preview-panel",innerHTML:C.value},null,8,At)):(d(),v("div",Ft,[...a[13]||(a[13]=[e("div",{class:"preview-empty-icon"},"ðŸ“",-1),e("div",{class:"preview-empty-text"},"æ–‡ç« å†…å®¹å°†åœ¨å†™ä½œé˜¶æ®µå®žæ—¶æ˜¾ç¤º",-1)])])),w($)&&w(i)?(d(),v("div",Ut,[...a[14]||(a[14]=[e("span",null,null,-1),e("span",null,null,-1),e("span",null,null,-1)])])):O("",!0),w(B)&&!w($)?(d(),v("div",jt,[e("button",{class:"view-article-btn",onClick:a[2]||(a[2]=P=>w(o).push(`/blog/${w(B)}`))}," ðŸ“– æŸ¥çœ‹æ–‡ç«  ")])):O("",!0)])])])],512),[[we,!n.value||l.value==="preview"]])]),n.value?(d(),v("div",Jt,[e("button",{class:le(["mobile-tab",{active:l.value==="activity"}]),onClick:a[3]||(a[3]=P=>l.value="activity")},"æ´»åŠ¨æ—¥å¿—",2),e("button",{class:le(["mobile-tab",{active:l.value==="preview"}]),onClick:a[4]||(a[4]=P=>l.value="preview"),disabled:!w(i)},"æ–‡ç« é¢„è§ˆ",10,Vt)])):O("",!0),ie(Lt,{visible:H.value,citation:A.value,index:Y.value,position:X.value},null,8,["visible","citation","index","position"]),ie(bt,{visible:s.value,evaluation:j.value,loading:N.value,onClose:a[5]||(a[5]=P=>s.value=!1)},null,8,["visible","evaluation","loading"])]))}}),Yt=ue(Gt,[["__scopeId","data-v-9661f3c1"]]);export{Yt as default};
