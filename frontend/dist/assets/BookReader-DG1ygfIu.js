import{d as te,q as oe,C as ae,c as o,a as s,t as i,b as D,w as P,k as d,n as O,F as $,r as x,g as E,e as le,x as ne,h as g,i as q,D as ie,j as re,o as a,z as de,_ as ce}from"./index-CX2luUoy.js";import{m as ue}from"./marked.esm-CURnbxgz.js";const pe={class:"terminal-nav"},ve={class:"terminal-nav-left"},me={class:"terminal-title"},he={class:"terminal-nav-right"},ge={key:0,class:"loading-state"},_e={key:1,class:"error-state"},ke={class:"code-line"},be={key:2,class:"reader-layout"},fe={class:"sidebar"},ye={class:"sidebar-header"},$e={class:"book-name"},we={class:"sidebar-nav"},Ce={class:"nav-group-title"},xe=["onClick"],Ee={class:"nav-icon"},He={class:"nav-text"},je={key:0,class:"nav-status built"},Me={key:1,class:"nav-status pending"},Ne={class:"content-area"},De={key:0,class:"book-home"},Oe={class:"terminal-panel"},qe={class:"terminal-panel-header"},Le={class:"panel-title"},Se={class:"terminal-panel-body"},Te={class:"code-block"},Be={class:"code-line indent"},Ae={class:"code-string"},Re={class:"code-line indent"},Ve={class:"code-number"},Fe={class:"code-line indent"},Ie={class:"code-number"},Ge={class:"code-line indent"},ze={class:"code-number"},Je={key:0,class:"book-slogan"},Ke={class:"book-desc"},Pe={key:0,class:"terminal-panel"},Qe={class:"terminal-panel-body"},Ue={key:1,class:"terminal-panel"},We={class:"terminal-panel-body"},Xe={class:"highlight-icon"},Ye={class:"highlight-title"},Ze={class:"highlight-desc"},es={class:"terminal-panel"},ss=["innerHTML"],ts={key:2,class:"terminal-panel"},os={class:"terminal-panel-body"},as={key:3,class:"terminal-panel"},ls={class:"terminal-panel-body"},ns={key:1,class:"chapter-content"},is={key:0,class:"loading-state",style:{height:"300px"}},rs={key:1,class:"pending-chapter"},ds=["innerHTML"],cs=te({__name:"BookReader",setup(us){const L=ne(),H=g(!1),j=g(!0),w=g(""),b=g(""),p=g(null),m=g(null),M=g(null),f=g(null),N=g(!1),k=g(""),Q=q(()=>{var e;if(!((e=p.value)!=null&&e.chapters))return{};const t={};for(const l of p.value.chapters){const c=l.chapter_title||"æœªåˆ†ç±»";t[c]||(t[c]=[]),t[c].push(l)}return t}),U=q(()=>{var t;return(t=M.value)!=null&&t.chapters?X(M.value):W()}),W=()=>{var l,c;if(!((c=(l=p.value)==null?void 0:l.chapters)!=null&&c.length))return"<p>æš‚æ— å¤§çº²</p>";const t={};for(const r of p.value.chapters){const n=r.chapter_index;t[n]||(t[n]={title:r.chapter_title,sections:[]}),t[n].sections.push(r)}let e="";for(const[r,n]of Object.entries(t)){e+=`<p><strong>ç¬¬ ${r} ç«  ${n.title}</strong></p><ul>`;for(const u of n.sections)u.blog_id?e+=`<li><a href="javascript:void(0)" onclick="window.loadChapter('${u.id}')">${u.section_index} ${u.section_title}</a> ğŸ“„</li>`:e+=`<li>${u.section_index} ${u.section_title} <em>(å¾…å®Œå–„)</em></li>`;e+="</ul>"}return e},X=t=>{var l,c;if(!((l=t==null?void 0:t.chapters)!=null&&l.length))return"<p>æš‚æ— å¤§çº²</p>";let e="";for(const r of t.chapters){e+=`<p><strong>ç¬¬ ${r.index} ç«  ${r.title}</strong></p><ul>`;for(const n of r.sections||[])if(n.type==="series"){const u=n.status==="built"?"âœ…":n.status==="partial"?"ğŸ”„":"ğŸ“";e+=`<li>${u} <strong>${n.title}</strong> (${((c=n.articles)==null?void 0:c.length)||0} ç¯‡)<ul>`;for(const v of n.articles||[]){const C=v.status==="built"?"âœ…":"ğŸ“";v.status==="built"&&v.chapter_id?e+=`<li>${C} [${v.order}/${v.total}] <a href="javascript:void(0)" onclick="window.loadChapter('${v.chapter_id}')">${v.title}</a></li>`:e+=`<li>${C} [${v.order}/${v.total}] ${v.title} <em>å¾…å»ºè®¾</em></li>`}e+="</ul></li>"}else{const u=n.status==="built"?"âœ…":"ğŸ“";n.status==="built"&&n.chapter_id?e+=`<li>${u} <a href="javascript:void(0)" onclick="window.loadChapter('${n.chapter_id}')">${n.title}</a></li>`:e+=`<li>${u} ${n.title} <em>å¾…å»ºè®¾</em></li>`}e+="</ul>"}return e},Y=q(()=>{if(!k.value)return"";let t=k.value;return t=t.replace(/\(\.\//g,"(/outputs/"),t=t.replace(/\(images\//g,"(/outputs/images/"),t=t.replace(/src="\.\/images\//g,'src="/outputs/images/'),ue(t)}),S=async()=>{if(!b.value){w.value="ç¼ºå°‘ä¹¦ç± ID å‚æ•°",j.value=!1;return}try{const e=await(await fetch(`/api/books/${b.value}`)).json();if(e.success){if(p.value=e.book,document.title=e.book.title+" - vibe-blog",e.book.homepage_content)try{m.value=typeof e.book.homepage_content=="string"?JSON.parse(e.book.homepage_content):e.book.homepage_content}catch(l){console.warn("è§£æé¦–é¡µå†…å®¹å¤±è´¥:",l)}if(e.book.full_outline)try{M.value=typeof e.book.full_outline=="string"?JSON.parse(e.book.full_outline):e.book.full_outline}catch(l){console.warn("è§£æå®Œæ•´å¤§çº²å¤±è´¥:",l)}}else w.value=e.error||"æ— æ³•è·å–ä¹¦ç±ä¿¡æ¯"}catch(t){w.value=t.message}finally{j.value=!1}},T=async t=>{f.value=t,N.value=!0,k.value="";try{const l=await(await fetch(`/api/books/${b.value}/chapters/${t}`)).json();l.success&&l.has_content&&l.markdown_content&&(k.value=l.markdown_content,await ie(),ee(),se())}catch(e){console.error("åŠ è½½ç« èŠ‚å¤±è´¥:",e)}finally{N.value=!1}},Z=()=>{f.value=null,k.value=""},ee=()=>{window.hljs&&document.querySelectorAll("pre code").forEach(t=>{window.hljs.highlightElement(t)})},se=()=>{window.mermaid&&(document.querySelectorAll("pre code.language-mermaid, pre code.lang-mermaid").forEach(t=>{var l;const e=t.parentElement;if(e){const c=document.createElement("div");c.className="mermaid";let r=t.textContent||"";r=r.replace(/(\bsubgraph\s+\w+)\[""\]/g,'$1[" "]'),r=r.replace(/(\w+)\[""\]/g,'$1[" "]'),c.textContent=r,(l=e.parentNode)==null||l.replaceChild(c,e)}}),window.mermaid.run({nodes:document.querySelectorAll(".mermaid")}))};return oe(()=>{b.value=L.params.id,S(),window.loadChapter=T}),ae(()=>L.params.id,t=>{t&&t!==b.value&&(b.value=t,f.value=null,k.value="",j.value=!0,S())}),(t,e)=>{var c,r,n,u,v,C,B,A,R,V,F,I,G,z,J,K;const l=re("router-link");return a(),o("div",{class:O(["reader-container",{"dark-mode":H.value}])},[s("nav",pe,[s("div",ve,[e[1]||(e[1]=s("div",{class:"terminal-dots"},[s("span",{class:"dot red"}),s("span",{class:"dot yellow"}),s("span",{class:"dot green"})],-1)),s("span",me,"$ cat "+i(((c=p.value)==null?void 0:c.title)||"book")+"/README.md",1)]),s("div",he,[e[3]||(e[3]=s("a",{href:"https://github.com/datawhalechina/vibe-blog",target:"_blank",rel:"noopener noreferrer",class:"nav-cmd",title:"GitHub - vibe-blog"},"GitHub",-1)),D(l,{to:"/books",class:"nav-cmd"},{default:P(()=>[...e[2]||(e[2]=[d("cd ~/books",-1)])]),_:1}),s("button",{class:"theme-toggle",onClick:e[0]||(e[0]=h=>H.value=!H.value)},i(H.value?"â˜€ï¸":"ğŸŒ™"),1)])]),j.value?(a(),o("div",ge,[...e[4]||(e[4]=[s("div",{class:"code-line"},[s("span",{class:"code-prompt"},"$"),d(" loading book...")],-1),s("div",{class:"spinner"},null,-1)])])):w.value?(a(),o("div",_e,[s("div",ke,[e[5]||(e[5]=s("span",{class:"code-prompt"},"$",-1)),e[6]||(e[6]=d()),e[7]||(e[7]=s("span",{class:"code-error"},"error:",-1)),d(" "+i(w.value),1)]),D(l,{to:"/books",class:"cmd-btn"},{default:P(()=>[...e[8]||(e[8]=[d("> cd ~/books",-1)])]),_:1})])):(a(),o("div",be,[s("aside",fe,[s("div",ye,[e[9]||(e[9]=s("div",{class:"terminal-dots-sm"},[s("span",{class:"dot red"}),s("span",{class:"dot yellow"}),s("span",{class:"dot green"})],-1)),s("span",$e,i((r=p.value)==null?void 0:r.title),1)]),s("nav",we,[s("div",{class:O(["nav-item home",{active:!f.value}]),onClick:Z},[...e[10]||(e[10]=[s("span",{class:"nav-icon"},"ğŸ“",-1),s("span",{class:"nav-text"},"README.md",-1)])],2),(a(!0),o($,null,x(Q.value,(h,_)=>(a(),o($,{key:_},[s("div",Ce,"// "+i(_),1),(a(!0),o($,null,x(h,y=>(a(),o("div",{key:y.id,class:O(["nav-item",{active:f.value===y.id}]),onClick:ps=>T(y.id)},[s("span",Ee,i(y.blog_id?"ğŸ“„":"ğŸ“"),1),s("span",He,i(y.section_title),1),y.blog_id?(a(),o("span",je,"âœ“")):(a(),o("span",Me,"..."))],10,xe))),128))],64))),128))])]),s("main",Ne,[f.value?(a(),o("div",ns,[N.value?(a(),o("div",is,[...e[31]||(e[31]=[s("div",{class:"code-line"},[s("span",{class:"code-prompt"},"$"),d(" loading chapter...")],-1),s("div",{class:"spinner"},null,-1)])])):k.value?(a(),o("div",{key:2,class:"markdown-body",innerHTML:Y.value},null,8,ds)):(a(),o("div",rs,[...e[32]||(e[32]=[le('<div class="code-line" data-v-98eb077f><span class="code-comment" data-v-98eb077f>// TODO: è¯¥ç« èŠ‚å†…å®¹å¾…å®Œå–„</span></div><div class="code-line" data-v-98eb077f><span class="code-prompt" data-v-98eb077f>$</span> <span class="cursor-blink" data-v-98eb077f>_</span></div>',2)])]))])):(a(),o("div",De,[s("div",Oe,[s("div",qe,[e[11]||(e[11]=s("div",{class:"terminal-dots-sm"},[s("span",{class:"dot red"}),s("span",{class:"dot yellow"}),s("span",{class:"dot green"})],-1)),s("span",Le,i((n=p.value)==null?void 0:n.title),1)]),s("div",Se,[s("div",Te,[e[24]||(e[24]=s("div",{class:"code-line"},[s("span",{class:"code-keyword"},"const"),d(),s("span",{class:"code-variable"},"book"),d(),s("span",{class:"code-operator"},"="),d(" {")],-1)),s("div",Be,[e[12]||(e[12]=s("span",{class:"code-key"},"title:",-1)),e[13]||(e[13]=d()),s("span",Ae,'"'+i((u=p.value)==null?void 0:u.title)+'"',1),e[14]||(e[14]=d(",",-1))]),s("div",Re,[e[15]||(e[15]=s("span",{class:"code-key"},"chapters:",-1)),e[16]||(e[16]=d()),s("span",Ve,i(((v=p.value)==null?void 0:v.chapters_count)||0),1),e[17]||(e[17]=d(",",-1))]),s("div",Fe,[e[18]||(e[18]=s("span",{class:"code-key"},"words:",-1)),e[19]||(e[19]=d()),s("span",Ie,i(((C=p.value)==null?void 0:C.total_word_count)||0),1),e[20]||(e[20]=d(",",-1))]),s("div",Ge,[e[21]||(e[21]=s("span",{class:"code-key"},"blogs:",-1)),e[22]||(e[22]=d()),s("span",ze,i(((B=p.value)==null?void 0:B.blogs_count)||0),1),e[23]||(e[23]=d(",",-1))]),e[25]||(e[25]=s("div",{class:"code-line"},"}",-1))]),(A=m.value)!=null&&A.slogan?(a(),o("p",Je,i(m.value.slogan),1)):E("",!0),s("p",Ke,i(((R=p.value)==null?void 0:R.description)||"æš‚æ— ç®€ä»‹"),1)])]),(V=m.value)!=null&&V.introduction?(a(),o("div",Pe,[e[26]||(e[26]=s("div",{class:"terminal-panel-header"},[s("span",{class:"panel-title"},"> introduction")],-1)),s("div",Qe,[s("p",null,i(m.value.introduction),1)])])):E("",!0),(I=(F=m.value)==null?void 0:F.highlights)!=null&&I.length?(a(),o("div",Ue,[e[27]||(e[27]=s("div",{class:"terminal-panel-header"},[s("span",{class:"panel-title"},"> highlights")],-1)),s("div",We,[(a(!0),o($,null,x(m.value.highlights,(h,_)=>(a(),o("div",{key:_,class:"highlight-item"},[s("span",Xe,i(h.icon),1),s("span",Ye,i(h.title),1),s("span",Ze,i(h.description),1)]))),128))])])):E("",!0),s("div",es,[e[28]||(e[28]=s("div",{class:"terminal-panel-header"},[s("span",{class:"panel-title"},"> tree ./chapters")],-1)),s("div",{class:"terminal-panel-body outline-content",innerHTML:U.value},null,8,ss)]),(z=(G=m.value)==null?void 0:G.target_audience)!=null&&z.length?(a(),o("div",ts,[e[29]||(e[29]=s("div",{class:"terminal-panel-header"},[s("span",{class:"panel-title"},"> target_audience")],-1)),s("div",os,[(a(!0),o($,null,x(m.value.target_audience,(h,_)=>(a(),o("div",{key:_,class:"list-item"},"- "+i(h),1))),128))])])):E("",!0),(K=(J=m.value)==null?void 0:J.prerequisites)!=null&&K.length?(a(),o("div",as,[e[30]||(e[30]=s("div",{class:"terminal-panel-header"},[s("span",{class:"panel-title"},"> prerequisites")],-1)),s("div",ls,[(a(!0),o($,null,x(m.value.prerequisites,(h,_)=>(a(),o("div",{key:_,class:"list-item"},"- "+i(h),1))),128))])])):E("",!0)]))])])),D(de)],2)}}}),hs=ce(cs,[["__scopeId","data-v-98eb077f"]]);export{hs as default};
