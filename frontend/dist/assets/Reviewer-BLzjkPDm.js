import{d as ns,q as ls,c as l,a as s,e as k,b as U,w as is,t as o,f as ds,v as rs,A as cs,F as C,r as x,g as v,k as P,n as _,h as u,i as us,j as ps,o as i,D as vs,z as ms,_ as _s}from"./index-CX2luUoy.js";import{m as fs}from"./marked.esm-CURnbxgz.js";const gs={class:"terminal-nav"},hs={class:"terminal-nav-right"},ys={class:"container"},ws={key:0,class:"list-page"},bs={class:"terminal-input-bar"},ks={class:"code-cards-grid"},Cs=["data-theme","onClick"],xs={class:"code-card-header"},$s={class:"card-status"},Es={class:"status-text"},Ts={class:"code-card-body"},Ns={class:"code-line"},Ss={class:"code-string"},Ds={class:"code-line"},Ls={class:"code-number"},js={class:"code-line"},Os={class:"code-number"},Ps={class:"code-line"},Rs={class:"code-number"},Vs={class:"code-comment"},Js={class:"code-card-footer"},Ms={class:"card-tags"},Fs={key:0,class:"code-tag tag-error"},qs={key:1,class:"code-tag tag-warn"},As={key:2,class:"code-tag tag-info"},Bs={key:0,class:"empty-state"},Gs={key:1,class:"detail-page"},Hs={class:"terminal-panel"},Is={class:"terminal-panel-header"},Us={class:"panel-title"},zs={class:"terminal-panel-body"},Ks={class:"code-line"},Qs={class:"code-string"},Ws={class:"stats-grid"},Xs={class:"stat-card primary"},Ys={class:"stat-value"},Zs={class:"stat-card"},se={class:"stat-value"},ee={class:"stat-card"},te={class:"stat-value"},ae={class:"terminal-panel"},oe={class:"terminal-panel-body"},ne={key:0,class:"code-comment"},le=["onClick"],ie={class:"line-num"},de={class:"file-name"},re={key:0,class:"file-issues"},ce={key:2,class:"chapter-detail-page"},ue={class:"chapter-nav"},pe={class:"chapter-path"},ve={class:"three-column-view"},me={class:"file-list-panel"},_e={class:"panel-body"},fe=["onClick"],ge={class:"file-icon"},he={class:"file-name"},ye={class:"content-panel"},we={class:"panel-header"},be={class:"code-string"},ke={class:"header-stats"},Ce={class:"panel-body content-body"},xe=["innerHTML"],$e={class:"issues-panel"},Ee={class:"panel-header"},Te={class:"issue-count"},Ne={class:"panel-body"},Se={key:0,class:"no-issues"},De={class:"issue-header"},Le={class:"issue-type"},je={class:"issue-desc"},Oe={key:0,class:"issue-suggestion"},Pe={class:"code-comment"},Re={key:0,class:"progress-panel"},Ve={class:"progress-body"},Je={class:"log-time"},Me={class:"log-msg"},Fe=ns({__name:"Reviewer",setup(qe){const $=u(!1),g=u("list"),w=u(""),S=u(!1),D=u([]);let n=null;const L=u([]),m=u(null),h=u(null),E=u([]),b=u(null),f=u(null),T=u([]),j=a=>a>=80?"score-high":a>=60?"score-medium":"score-low",z=a=>a>=80?"devops":a>=60?"security":"tutorial",K=a=>({pending:"pending",cloning:"cloning...",scanning:"scanning...",evaluating:"running...",completed:"done âœ“",failed:"error âœ—"})[a]||a,Q=us(()=>{var a;if(!((a=f.value)!=null&&a.raw_content))return"<p>æš‚æ— å†…å®¹</p>";try{return fs(f.value.raw_content)}catch{return`<pre>${f.value.raw_content}</pre>`}}),O=async()=>{try{const e=await(await fetch("/api/reviewer/tutorials")).json();e.success&&(L.value=e.tutorials)}catch(a){console.error("åŠ è½½æ•™ç¨‹åˆ—è¡¨å¤±è´¥:",a)}},R=async()=>{if(!w.value.trim()){alert("è¯·è¾“å…¥ Git ä»“åº“ URL");return}try{const e=await(await fetch("/api/reviewer/tutorials",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({git_url:w.value})})).json();e.success?(w.value="",O()):alert(e.error||"æ·»åŠ å¤±è´¥")}catch(a){alert("æ·»åŠ å¤±è´¥: "+a.message)}},V=()=>{g.value="list",m.value=null,O()},J=async a=>{m.value=a,g.value="detail";try{const[e,c]=await Promise.all([fetch(`/api/reviewer/tutorials/${a}`),fetch(`/api/reviewer/tutorials/${a}/chapters`)]),d=await e.json(),r=await c.json();d.success&&(h.value=d.tutorial),r.success&&(E.value=r.chapters)}catch(e){console.error("åŠ è½½è¯¦æƒ…å¤±è´¥:",e)}},M=async a=>{b.value=a,g.value="chapter";try{const c=await(await fetch(`/api/reviewer/chapters/${a}/issues`)).json();if(c.success){f.value=c.chapter;const d={high:0,medium:1,low:2};T.value=[...c.issues||[]].sort((r,N)=>d[r.severity]-d[N.severity]),await vs(),ts(),as()}}catch(e){console.error("åŠ è½½ç« èŠ‚è¯¦æƒ…å¤±è´¥:",e)}},W=async a=>{a!==b.value&&await M(a)},X=()=>{g.value="detail",b.value=null},Y=()=>{if(!m.value)return;const a=confirm("æ˜¯å¦å¼ºåˆ¶é‡æ–°è¯„ä¼°ï¼Ÿ"),e=prompt("è¯·è¾“å…¥è¦è¯„ä¼°çš„ç« èŠ‚æ•° (æœ€å¤§ 5):","5");if(e===null)return;let c=Math.min(parseInt(e)||5,5);S.value=!0,D.value=[{message:"ğŸš€ å¼€å§‹è¯„ä¼°...",type:""}],n&&n.close(),n=new EventSource(`/api/reviewer/tutorials/${m.value}/evaluate-stream?max_chapters=${c}&force=${a}`),n.onmessage=d=>{const r=JSON.parse(d.data);y(r.message||JSON.stringify(r))},n.addEventListener("progress",d=>{const r=JSON.parse(d.data);y(r.message||"å¤„ç†ä¸­...")}),n.addEventListener("chapter_complete",d=>{const r=JSON.parse(d.data);y(`âœ… ${r.chapter_title||"ç« èŠ‚"} è¯„ä¼°å®Œæˆ`,"success")}),n.addEventListener("complete",()=>{y("ğŸ‰ è¯„ä¼°å®Œæˆï¼","success"),n==null||n.close(),n=null,J(m.value)}),n.addEventListener("error",d=>{if(d.data){const r=JSON.parse(d.data);y(`âŒ ${r.message||"è¯„ä¼°å¤±è´¥"}`,"error")}n==null||n.close(),n=null}),n.onerror=()=>{(n==null?void 0:n.readyState)!==EventSource.CLOSED&&(y("âŒ è¿æ¥æ–­å¼€","error"),n==null||n.close(),n=null)}},y=(a,e="")=>{D.value.push({message:a,type:e})},Z=()=>{S.value=!1,n&&(n.close(),n=null)},ss=()=>{m.value&&window.open(`/api/reviewer/tutorials/${m.value}/export`,"_blank")},es=async()=>{if(!(!m.value||!confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ•™ç¨‹å—ï¼Ÿ")))try{const e=await(await fetch(`/api/reviewer/tutorials/${m.value}`,{method:"DELETE"})).json();e.success?V():alert(e.error||"åˆ é™¤å¤±è´¥")}catch(a){alert("åˆ é™¤å¤±è´¥: "+a.message)}},ts=()=>{window.hljs&&document.querySelectorAll("pre code").forEach(a=>window.hljs.highlightElement(a))},as=()=>{window.mermaid&&(document.querySelectorAll("pre code.language-mermaid").forEach(a=>{var c;const e=a.parentElement;if(e){const d=document.createElement("div");d.className="mermaid",d.textContent=a.textContent||"",(c=e.parentNode)==null||c.replaceChild(d,e)}}),window.mermaid.run({nodes:document.querySelectorAll(".mermaid")}))};return ls(()=>{O()}),(a,e)=>{var d,r,N,F,q,A,B,G,H,I;const c=ps("router-link");return i(),l("div",{class:_(["reviewer-container",{"dark-mode":$.value}])},[s("nav",gs,[e[4]||(e[4]=k('<div class="terminal-nav-left" data-v-5e1014df><div class="terminal-dots" data-v-5e1014df><span class="dot red" data-v-5e1014df></span><span class="dot yellow" data-v-5e1014df></span><span class="dot green" data-v-5e1014df></span></div><span class="terminal-title" data-v-5e1014df>$ reviewer --mode=evaluate</span></div>',1)),s("div",hs,[e[3]||(e[3]=s("a",{href:"https://github.com/datawhalechina/vibe-blog",target:"_blank",rel:"noopener noreferrer",class:"nav-cmd",title:"GitHub - vibe-blog"},"GitHub",-1)),U(c,{to:"/",class:"nav-cmd"},{default:is(()=>[...e[2]||(e[2]=[P("cd ~/vibe-blog",-1)])]),_:1}),s("button",{class:"theme-toggle",onClick:e[0]||(e[0]=t=>$.value=!$.value)},o($.value?"â˜€ï¸":"ğŸŒ™"),1)])]),s("div",ys,[e[40]||(e[40]=s("div",{class:"page-title"},[s("h1",null,"> æ•™ç¨‹è´¨é‡è¯„ä¼°_"),s("p",{class:"code-comment"},"// æ·»åŠ  Git ä»“åº“ï¼Œè‡ªåŠ¨è¯„ä¼°æ•™ç¨‹è´¨é‡ï¼Œå‘ç°é—®é¢˜å¹¶ç»™å‡ºæ”¹è¿›å»ºè®®")],-1)),g.value==="list"?(i(),l("div",ws,[s("div",bs,[e[5]||(e[5]=k('<div class="terminal-dots-sm" data-v-5e1014df><span class="dot red" data-v-5e1014df></span><span class="dot yellow" data-v-5e1014df></span><span class="dot green" data-v-5e1014df></span></div><span class="input-label" data-v-5e1014df>git clone</span>',2)),ds(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>w.value=t),type:"text",placeholder:"https://github.com/user/tutorial.git",onKeyup:cs(R,["enter"])},null,544),[[rs,w.value]]),s("button",{class:"execute-btn",onClick:R},"> run")]),s("div",ks,[(i(!0),l(C,null,x(L.value,t=>{var p;return i(),l("div",{key:t.id,class:"code-card","data-theme":z(t.overall_score),onClick:os=>J(t.id)},[s("div",xs,[e[6]||(e[6]=s("div",{class:"card-folder"},[s("span",{class:"folder-icon"},"ğŸ“"),s("span",{class:"folder-name"},"tutorials/")],-1)),s("div",$s,[s("span",{class:_(["status-dot",t.status])},null,2),s("span",Es,o(K(t.status)),1)])]),s("div",Ts,[s("div",Ns,[e[7]||(e[7]=s("span",{class:"line-num"},"1",-1)),e[8]||(e[8]=s("span",{class:"code-keyword"},"const",-1)),e[9]||(e[9]=s("span",{class:"code-variable"},"tutorial",-1)),e[10]||(e[10]=s("span",{class:"code-operator"},"=",-1)),s("span",Ss,'"'+o(t.name)+'"',1)]),s("div",Ds,[e[11]||(e[11]=s("span",{class:"line-num"},"2",-1)),e[12]||(e[12]=s("span",{class:"code-keyword"},"const",-1)),e[13]||(e[13]=s("span",{class:"code-variable"},"score",-1)),e[14]||(e[14]=s("span",{class:"code-operator"},"=",-1)),s("span",Ls,o(((p=t.overall_score)==null?void 0:p.toFixed(0))||0),1)]),s("div",js,[e[15]||(e[15]=s("span",{class:"line-num"},"3",-1)),e[16]||(e[16]=s("span",{class:"code-keyword"},"const",-1)),e[17]||(e[17]=s("span",{class:"code-variable"},"chapters",-1)),e[18]||(e[18]=s("span",{class:"code-operator"},"=",-1)),s("span",Os,o(t.total_chapters||0),1)]),s("div",Ps,[e[19]||(e[19]=s("span",{class:"line-num"},"4",-1)),e[20]||(e[20]=s("span",{class:"code-keyword"},"const",-1)),e[21]||(e[21]=s("span",{class:"code-variable"},"issues",-1)),e[22]||(e[22]=s("span",{class:"code-operator"},"=",-1)),s("span",Rs,o(t.total_issues||0),1),s("span",Vs,"// "+o(t.high_issues||0)+" high, "+o(t.medium_issues||0)+" medium",1)]),e[23]||(e[23]=s("div",{class:"code-line command-line"},[s("span",{class:"code-prompt"},"$"),s("span",{class:"code-cmd"},"git remote -v")],-1))]),s("div",Js,[s("div",Ms,[t.high_issues>0?(i(),l("span",Fs,"error: "+o(t.high_issues),1)):v("",!0),t.medium_issues>0?(i(),l("span",qs,"warn: "+o(t.medium_issues),1)):v("",!0),t.low_issues>0?(i(),l("span",As,"info: "+o(t.low_issues),1)):v("",!0)]),e[24]||(e[24]=s("span",{class:"card-arrow"},"â†’",-1))])],8,Cs)}),128))]),L.value.length===0?(i(),l("div",Bs,[...e[25]||(e[25]=[k('<div class="empty-terminal" data-v-5e1014df><div class="code-line" data-v-5e1014df><span class="code-prompt" data-v-5e1014df>$</span> ls tutorials/</div><div class="code-line" data-v-5e1014df><span class="code-comment" data-v-5e1014df>// ç›®å½•ä¸ºç©º</span></div><div class="code-line" data-v-5e1014df><span class="code-prompt" data-v-5e1014df>$</span> <span class="cursor-blink" data-v-5e1014df>_</span></div></div>',1)])])):v("",!0)])):g.value==="detail"?(i(),l("div",Gs,[s("div",Hs,[s("div",Is,[e[26]||(e[26]=s("div",{class:"terminal-dots-sm"},[s("span",{class:"dot red"}),s("span",{class:"dot yellow"}),s("span",{class:"dot green"})],-1)),s("span",Us,o((d=h.value)==null?void 0:d.name),1),s("button",{class:"back-cmd",onClick:V},"cd ..")]),s("div",zs,[s("div",Ks,[e[27]||(e[27]=s("span",{class:"code-keyword"},"export",-1)),e[28]||(e[28]=P()),e[29]||(e[29]=s("span",{class:"code-variable"},"REPO",-1)),e[30]||(e[30]=s("span",{class:"code-operator"},"=",-1)),s("span",Qs,'"'+o((r=h.value)==null?void 0:r.git_url)+'"',1)]),s("div",Ws,[s("div",Xs,[s("div",Ys,o(((F=(N=h.value)==null?void 0:N.overall_score)==null?void 0:F.toFixed(1))||"-"),1),e[31]||(e[31]=s("div",{class:"stat-label"},"score",-1))]),s("div",Zs,[s("div",se,o(((q=h.value)==null?void 0:q.total_chapters)||0),1),e[32]||(e[32]=s("div",{class:"stat-label"},"chapters",-1))]),s("div",ee,[s("div",te,o(((A=h.value)==null?void 0:A.total_issues)||0),1),e[33]||(e[33]=s("div",{class:"stat-label"},"issues",-1))])]),s("div",{class:"action-buttons"},[s("button",{class:"cmd-btn primary",onClick:Y},"> evaluate"),s("button",{class:"cmd-btn",onClick:ss},"> export"),s("button",{class:"cmd-btn danger",onClick:es},"> rm -rf")])])]),s("div",ae,[e[35]||(e[35]=s("div",{class:"terminal-panel-header"},[s("span",{class:"panel-title"},"> ls chapters/")],-1)),s("div",oe,[E.value.length===0?(i(),l("div",ne,"// æš‚æ— ç« èŠ‚æ•°æ®ï¼Œè¯·å…ˆè¿›è¡Œè¯„ä¼°")):v("",!0),(i(!0),l(C,null,x(E.value,(t,p)=>(i(),l("div",{key:t.id,class:"file-row",onClick:os=>M(t.id)},[s("span",ie,o(p+1),1),e[34]||(e[34]=s("span",{class:"file-icon"},"ğŸ“„",-1)),s("span",de,o(t.file_name),1),s("span",{class:_(["file-score",j(t.overall_score)])},o(t.overall_score||0),3),t.total_issues>0?(i(),l("span",re,o(t.total_issues)+" issues",1)):v("",!0)],8,le))),128))])])])):g.value==="chapter"?(i(),l("div",ce,[s("div",ue,[s("button",{class:"back-cmd",onClick:X},"cd .."),s("span",pe,o((B=f.value)==null?void 0:B.file_path),1)]),s("div",ve,[s("div",me,[e[36]||(e[36]=k('<div class="panel-header" data-v-5e1014df><span class="terminal-dots-sm" data-v-5e1014df><span class="dot red" data-v-5e1014df></span><span class="dot yellow" data-v-5e1014df></span><span class="dot green" data-v-5e1014df></span></span><span data-v-5e1014df>files</span></div>',1)),s("div",_e,[(i(!0),l(C,null,x(E.value,t=>(i(),l("div",{key:t.id,class:_(["file-item",{active:b.value===t.id}]),onClick:p=>W(t.id)},[s("span",ge,o(b.value===t.id?"â–¶":"ã€€"),1),s("span",he,o(t.file_name),1),s("span",{class:_(["file-score",j(t.overall_score||0)])},o(t.overall_score||0),3)],10,fe))),128))])]),s("div",ye,[s("div",we,[s("span",be,'"'+o((G=f.value)==null?void 0:G.file_path)+'"',1),s("span",ke,[e[37]||(e[37]=P("score: ",-1)),s("span",{class:_(j(((H=f.value)==null?void 0:H.overall_score)||0))},o(((I=f.value)==null?void 0:I.overall_score)||0),3)])]),s("div",Ce,[s("div",{class:"markdown-content",innerHTML:Q.value},null,8,xe)])]),s("div",$e,[s("div",Ee,[e[38]||(e[38]=s("span",null,"issues",-1)),s("span",Te,o(T.value.length),1)]),s("div",Ne,[T.value.length===0?(i(),l("div",Se,[...e[39]||(e[39]=[s("span",{class:"code-string"},'"No issues found"',-1)])])):v("",!0),(i(!0),l(C,null,x(T.value,(t,p)=>(i(),l("div",{key:p,class:_(["issue-card",t.severity])},[s("div",De,[s("span",{class:_(["issue-badge",t.severity])},o(t.severity),3),s("span",Le,o(t.issue_type),1)]),s("div",je,o(t.description),1),t.suggestion?(i(),l("div",Oe,[s("span",Pe,"// "+o(t.suggestion),1)])):v("",!0)],2))),128))])])])])):v("",!0)]),S.value?(i(),l("div",Re,[s("div",{class:"terminal-panel-header"},[e[41]||(e[41]=k('<div class="terminal-dots-sm" data-v-5e1014df><span class="dot red" data-v-5e1014df></span><span class="dot yellow" data-v-5e1014df></span><span class="dot green" data-v-5e1014df></span></div><span class="panel-title" data-v-5e1014df>$ evaluate --verbose</span>',2)),s("button",{class:"close-btn",onClick:Z},"Ã—")]),s("div",Ve,[(i(!0),l(C,null,x(D.value,(t,p)=>(i(),l("div",{key:p,class:_(["log-line",t.type])},[s("span",Je,"["+o(String(p).padStart(2,"0"))+"]",1),s("span",Me,o(t.message),1)],2))),128))])])):v("",!0),U(ms)],2)}}}),Ge=_s(Fe,[["__scopeId","data-v-5e1014df"]]);export{Ge as default};
