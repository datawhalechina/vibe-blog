# ç¼“å­˜ç³»ç»Ÿä½¿ç”¨æ–‡æ¡£

## æ¦‚è¿°

Researcher Agent æ”¯æŒæœ¬åœ°æ–‡ä»¶ç¼“å­˜æœºåˆ¶ï¼Œä½¿ç”¨ **diskcache** åº“å®ç°ï¼Œå¯ä»¥ç¼“å­˜æœç´¢ç»“æœå’Œ LLM å¤„ç†ç»“æœï¼Œé¿å…é‡å¤è°ƒç”¨ APIï¼ŒèŠ‚çœæˆæœ¬å’Œæ—¶é—´ã€‚

**ç‰¹ç‚¹ï¼š**
- âœ… çº¯æœ¬åœ°ç¼“å­˜ï¼Œæ— éœ€å¤–éƒ¨æœåŠ¡
- âœ… è‡ªåŠ¨è¿‡æœŸç®¡ç†ï¼ˆTTLï¼‰
- âœ… é«˜æ€§èƒ½ç£ç›˜ç¼“å­˜
- âœ… é›¶é…ç½®ï¼Œå¼€ç®±å³ç”¨

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pip install diskcache
```

### é»˜è®¤ä½¿ç”¨

æ— éœ€ä»»ä½•é…ç½®ï¼Œç¼“å­˜å·²è‡ªåŠ¨å¯ç”¨ï¼š

```bash
# ç¼“å­˜ç›®å½•ï¼šbackend/cache/
# é»˜è®¤ TTLï¼š24 å°æ—¶
```

## ç¯å¢ƒå˜é‡é…ç½®

### ç¼“å­˜å¼€å…³

```bash
# å¯ç”¨/ç¦ç”¨ Researcher ç¼“å­˜ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
RESEARCHER_CACHE_ENABLED=true
```

### ç¼“å­˜è¿‡æœŸæ—¶é—´

```bash
# ç¼“å­˜ TTLï¼ˆå°æ—¶ï¼‰ï¼Œé»˜è®¤ 24 å°æ—¶
CACHE_TTL_HOURS=24
```

## ç¼“å­˜ç­–ç•¥

### ç¼“å­˜çš„å†…å®¹

1. **æœç´¢ç»“æœ** (`search`)
   - ç¼“å­˜é”®ï¼štopic + target_audience + max_results
   - é¿å…é‡å¤è°ƒç”¨æœç´¢ API

2. **æ™ºèƒ½æœç´¢ç»“æœ** (`smart_search`)
   - ç¼“å­˜é”®ï¼štopic + target_audience + max_results
   - é¿å…é‡å¤è°ƒç”¨å¤šæºæœç´¢

3. **LLM æ•´ç†ç»“æœ** (`summarize`)
   - ç¼“å­˜é”®ï¼štopic + target_audience + search_depth + result_urls
   - é¿å…é‡å¤è°ƒç”¨ LLM API

### ç¼“å­˜è¿‡æœŸæ—¶é—´

- é»˜è®¤ TTLï¼š24 å°æ—¶
- å¯é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼š`CACHE_TTL_HOURS=48`
- ä¹Ÿå¯é€šè¿‡ä»£ç é…ç½®ï¼š

```python
from services.blog_generator.utils.cache_utils import init_cache_manager

# è®¾ç½® 48 å°æ—¶è¿‡æœŸ
init_cache_manager(ttl_hours=48)
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨

ç¼“å­˜å·²è‡ªåŠ¨é›†æˆåˆ° Researcher Agentï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼š

```python
from services.blog_generator.agents.researcher import ResearcherAgent

# åˆ›å»º Researcherï¼ˆè‡ªåŠ¨å¯ç”¨ç¼“å­˜ï¼‰
researcher = ResearcherAgent(llm_client, search_service)

# ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼šä» API è·å–æ•°æ®å¹¶ç¼“å­˜
state = researcher.run({'topic': 'ä»€ä¹ˆæ˜¯ RAG', 'target_audience': 'intermediate'})

# ç¬¬äºŒæ¬¡è°ƒç”¨ï¼šç›´æ¥ä»ç¼“å­˜è¯»å–ï¼ˆç›¸åŒå‚æ•°ï¼‰
state = researcher.run({'topic': 'ä»€ä¹ˆæ˜¯ RAG', 'target_audience': 'intermediate'})
```

### æ‰‹åŠ¨ç®¡ç†ç¼“å­˜

```python
from services.blog_generator.utils.cache_utils import get_cache_manager

cache = get_cache_manager()

# è·å–ç¼“å­˜ç»Ÿè®¡
stats = cache.get_stats()
print(f"ç¼“å­˜ç»Ÿè®¡: {stats}")
# è¾“å‡º: {'backend': 'diskcache', 'total_keys': 15, 'cache_dir': '/path/to/cache', 'size_mb': 2.5}

# æ¸…é™¤ç‰¹å®šå‰ç¼€çš„ç¼“å­˜
cache.clear('search')  # åªæ¸…é™¤æœç´¢ç¼“å­˜

# æ¸…é™¤æ‰€æœ‰ç¼“å­˜
cache.clear()
```

### ç¦ç”¨ç¼“å­˜

å¦‚æœéœ€è¦ä¸´æ—¶ç¦ç”¨ç¼“å­˜ï¼š

```bash
# åœ¨ .env ä¸­è®¾ç½®
RESEARCHER_CACHE_ENABLED=false
```

## ç¼“å­˜å‘½ä¸­æ—¥å¿—

å¯ç”¨ç¼“å­˜åï¼Œæ—¥å¿—ä¸­ä¼šæ˜¾ç¤ºç¼“å­˜å‘½ä¸­æƒ…å†µï¼š

```
2026-02-09 23:30:00 - INFO - ğŸ’¾ ç¼“å­˜ç®¡ç†å™¨åˆå§‹åŒ–: /path/to/cache, TTL=24h
2026-02-09 23:30:01 - INFO - ğŸ’¾ Researcher ç¼“å­˜å·²å¯ç”¨
2026-02-09 23:30:02 - INFO - âœ… å‘½ä¸­ç¼“å­˜: smart_search_abc123def456
2026-02-09 23:30:03 - INFO - ğŸ’¾ ç¼“å­˜å·²ä¿å­˜: summarize_xyz789ghi012
```

## æ€§èƒ½å¯¹æ¯”

### æ— ç¼“å­˜

```
æœç´¢ + LLM å¤„ç†ï¼š~30-60 ç§’
API æˆæœ¬ï¼šæ¯æ¬¡è°ƒç”¨éƒ½äº§ç”Ÿè´¹ç”¨
```

### æœ‰ç¼“å­˜

```
é¦–æ¬¡ï¼š~30-60 ç§’ï¼ˆæ­£å¸¸è°ƒç”¨ + å†™å…¥ç¼“å­˜ï¼‰
åç»­ï¼š<1 ç§’ï¼ˆç›´æ¥è¯»å–ç¼“å­˜ï¼‰
API æˆæœ¬ï¼šä»…é¦–æ¬¡è°ƒç”¨äº§ç”Ÿè´¹ç”¨
```

## æ³¨æ„äº‹é¡¹

1. **ç¼“å­˜ç›®å½•**ï¼š
   - ç¼“å­˜æ–‡ä»¶å­˜å‚¨åœ¨ `backend/cache/` ç›®å½•
   - diskcache ä¼šè‡ªåŠ¨ç®¡ç†ç¼“å­˜æ–‡ä»¶
   - å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜ä»¥èŠ‚çœç£ç›˜ç©ºé—´

2. **ç¼“å­˜å¤±æ•ˆ**ï¼š
   - ä¿®æ”¹æœç´¢å‚æ•°ä¼šç”Ÿæˆæ–°çš„ç¼“å­˜é”®
   - TTL è¿‡æœŸåè‡ªåŠ¨å¤±æ•ˆ
   - å¯æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜

3. **æ€§èƒ½**ï¼š
   - diskcache ä½¿ç”¨ SQLite ä½œä¸ºç´¢å¼•ï¼Œæ€§èƒ½ä¼˜ç§€
   - æ”¯æŒå¹¶å‘è¯»å†™
   - è‡ªåŠ¨å¤„ç†ç¼“å­˜æ·˜æ±°

## æ•…éšœæ’æŸ¥

### diskcache æœªå®‰è£…

```
é”™è¯¯ï¼šdiskcache æœªå®‰è£…ï¼Œç¼“å­˜åŠŸèƒ½å°†è¢«ç¦ç”¨
è§£å†³ï¼špip install diskcache
```

### ç¼“å­˜æœªå‘½ä¸­

```
åŸå› ï¼š
1. å‚æ•°ä¸å®Œå…¨ç›¸åŒï¼ˆtopicã€target_audience ç­‰ï¼‰
2. ç¼“å­˜å·²è¿‡æœŸï¼ˆè¶…è¿‡ TTLï¼‰
3. ç¼“å­˜è¢«æ‰‹åŠ¨æ¸…é™¤
```

### ç£ç›˜ç©ºé—´ä¸è¶³

```
è§£å†³ï¼š
1. æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜ï¼šcache.clear()
2. å‡å°‘ TTL æ—¶é—´ï¼šCACHE_TTL_HOURS=12
3. å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜
```

## æœ€ä½³å®è·µ

1. **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨é»˜è®¤é…ç½®ï¼Œæ–¹ä¾¿è°ƒè¯•
2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ TTL
3. **å®šæœŸæ¸…ç†**ï¼šè®¾ç½®åˆç†çš„ TTLï¼Œé¿å…ç¼“å­˜å †ç§¯
4. **ç›‘æ§ç»Ÿè®¡**ï¼šå®šæœŸæŸ¥çœ‹ `cache.get_stats()` äº†è§£ç¼“å­˜ä½¿ç”¨æƒ…å†µ

## diskcache ä¼˜åŠ¿

ç›¸æ¯”è‡ªå·±å®ç°çš„æ–‡ä»¶ç¼“å­˜ï¼Œdiskcache æä¾›ï¼š

- âœ… è‡ªåŠ¨è¿‡æœŸç®¡ç†ï¼ˆTTLï¼‰
- âœ… å¹¶å‘å®‰å…¨ï¼ˆå¤šè¿›ç¨‹/å¤šçº¿ç¨‹ï¼‰
- âœ… é«˜æ€§èƒ½ç´¢å¼•ï¼ˆSQLiteï¼‰
- âœ… è‡ªåŠ¨ç¼“å­˜æ·˜æ±°ï¼ˆLRUï¼‰
- âœ… åŸå­æ“ä½œä¿è¯
- âœ… ç¼“å­˜ç»Ÿè®¡å’Œç›‘æ§

## ç¤ºä¾‹ï¼šæŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡

```python
from services.blog_generator.utils.cache_utils import get_cache_manager

cache = get_cache_manager()
stats = cache.get_stats()

print(f"ç¼“å­˜åç«¯: {stats['backend']}")
print(f"ç¼“å­˜æ•°é‡: {stats['total_keys']}")
print(f"ç¼“å­˜å¤§å°: {stats['size_mb']} MB")
print(f"ç¼“å­˜ç›®å½•: {stats['cache_dir']}")
```

è¾“å‡ºï¼š
```
ç¼“å­˜åç«¯: diskcache
ç¼“å­˜æ•°é‡: 15
ç¼“å­˜å¤§å°: 2.5 MB
ç¼“å­˜ç›®å½•: /Users/xxx/vibe-blog/backend/cache
```
